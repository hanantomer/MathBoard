import{O as he,E as Zt,a0 as to,a1 as Be,a2 as mn,G as Hn,a3 as Ur,p as $n,a4 as no,a5 as ro,n as et,w as Q,d as tt,r as W,q as G,o as fe,c as He,e as k,g as _,V as ze,h as io,s as qr,k as ae,i as we,l as ie,f as X,a6 as jr,m as zr,U as oo,a7 as so,a8 as ao,Y as uo,a9 as co,aa as lo,ab as fo,ac as ho,ad as po,ae as go,_ as vo,af as yo,ag as or,ah as mo,ai as wo,S as ce,F as pt,aj as wn,ak as _o,al as bo,am as Eo,$ as xo,an as ln,ao as So,ap as Co,aq as ko,t as vt,ar as Ce,D as sr,B as me,j as Ke,I as Ao,as as ct,at as Ro,au as Oo,av as Mo}from"./index-83a93b04.js";import{c as ne,g as No}from"./_commonjsHelpers-725317a4.js";import{u as To,V as Kr}from"./lessonStore-85165b61.js";import{a as Xe,b as Xr,V as Yr,c as Wr}from"./VCard-d9169958.js";import{a as $e,V as Gr}from"./VDialog-bcf93b6d.js";function Lo(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((t-e)/n))|0,s=new Array(i);++r<i;)s[r]=e+r*n;return s}var Po={value:()=>{}};function Qr(){for(var e=0,t=arguments.length,n={},r;e<t;++e){if(!(r=arguments[e]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Ht(n)}function Ht(e){this._=e}function Bo(e,t){return e.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}Ht.prototype=Qr.prototype={constructor:Ht,on:function(e,t){var n=this._,r=Bo(e+"",n),i,s=-1,o=r.length;if(arguments.length<2){for(;++s<o;)if((i=(e=r[s]).type)&&(i=Io(n[i],e.name)))return i;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<o;)if(i=(e=r[s]).type)n[i]=ar(n[i],e.name,t);else if(t==null)for(i in n)n[i]=ar(n[i],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Ht(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,s;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=this._[e],r=0,i=s.length;r<i;++r)s[r].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,s=r.length;i<s;++i)r[i].value.apply(t,n)}};function Io(e,t){for(var n=0,r=e.length,i;n<r;++n)if((i=e[n]).name===t)return i.value}function ar(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=Po,e=e.slice(0,r).concat(e.slice(r+1));break}return n!=null&&e.push({name:t,value:n}),e}var _n="http://www.w3.org/1999/xhtml";const ur={svg:"http://www.w3.org/2000/svg",xhtml:_n,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function en(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),ur.hasOwnProperty(t)?{space:ur[t],local:e}:e}function Ho(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===_n&&t.documentElement.namespaceURI===_n?t.createElement(e):t.createElementNS(n,e)}}function $o(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Jr(e){var t=en(e);return(t.local?$o:Ho)(t)}function Do(){}function Dn(e){return e==null?Do:function(){return this.querySelector(e)}}function Fo(e){typeof e!="function"&&(e=Dn(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s=t[i],o=s.length,u=r[i]=new Array(o),a,c,l=0;l<o;++l)(a=s[l])&&(c=e.call(a,a.__data__,l,s))&&("__data__"in a&&(c.__data__=a.__data__),u[l]=c);return new ue(r,this._parents)}function Vo(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function Uo(){return[]}function Zr(e){return e==null?Uo:function(){return this.querySelectorAll(e)}}function qo(e){return function(){return Vo(e.apply(this,arguments))}}function jo(e){typeof e=="function"?e=qo(e):e=Zr(e);for(var t=this._groups,n=t.length,r=[],i=[],s=0;s<n;++s)for(var o=t[s],u=o.length,a,c=0;c<u;++c)(a=o[c])&&(r.push(e.call(a,a.__data__,c,o)),i.push(a));return new ue(r,i)}function ei(e){return function(){return this.matches(e)}}function ti(e){return function(t){return t.matches(e)}}var zo=Array.prototype.find;function Ko(e){return function(){return zo.call(this.children,e)}}function Xo(){return this.firstElementChild}function Yo(e){return this.select(e==null?Xo:Ko(typeof e=="function"?e:ti(e)))}var Wo=Array.prototype.filter;function Go(){return Array.from(this.children)}function Qo(e){return function(){return Wo.call(this.children,e)}}function Jo(e){return this.selectAll(e==null?Go:Qo(typeof e=="function"?e:ti(e)))}function Zo(e){typeof e!="function"&&(e=ei(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s=t[i],o=s.length,u=r[i]=[],a,c=0;c<o;++c)(a=s[c])&&e.call(a,a.__data__,c,s)&&u.push(a);return new ue(r,this._parents)}function ni(e){return new Array(e.length)}function es(){return new ue(this._enter||this._groups.map(ni),this._parents)}function Kt(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Kt.prototype={constructor:Kt,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function ts(e){return function(){return e}}function ns(e,t,n,r,i,s){for(var o=0,u,a=t.length,c=s.length;o<c;++o)(u=t[o])?(u.__data__=s[o],r[o]=u):n[o]=new Kt(e,s[o]);for(;o<a;++o)(u=t[o])&&(i[o]=u)}function rs(e,t,n,r,i,s,o){var u,a,c=new Map,l=t.length,f=s.length,h=new Array(l),p;for(u=0;u<l;++u)(a=t[u])&&(h[u]=p=o.call(a,a.__data__,u,t)+"",c.has(p)?i[u]=a:c.set(p,a));for(u=0;u<f;++u)p=o.call(e,s[u],u,s)+"",(a=c.get(p))?(r[u]=a,a.__data__=s[u],c.delete(p)):n[u]=new Kt(e,s[u]);for(u=0;u<l;++u)(a=t[u])&&c.get(h[u])===a&&(i[u]=a)}function is(e){return e.__data__}function os(e,t){if(!arguments.length)return Array.from(this,is);var n=t?rs:ns,r=this._parents,i=this._groups;typeof e!="function"&&(e=ts(e));for(var s=i.length,o=new Array(s),u=new Array(s),a=new Array(s),c=0;c<s;++c){var l=r[c],f=i[c],h=f.length,p=ss(e.call(l,l&&l.__data__,c,r)),b=p.length,C=u[c]=new Array(b),H=o[c]=new Array(b),T=a[c]=new Array(h);n(l,f,C,H,T,p,t);for(var A=0,N=0,O,m;A<b;++A)if(O=C[A]){for(A>=N&&(N=A+1);!(m=H[N])&&++N<b;);O._next=m||null}}return o=new ue(o,r),o._enter=u,o._exit=a,o}function ss(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function as(){return new ue(this._exit||this._groups.map(ni),this._parents)}function us(e,t,n){var r=this.enter(),i=this,s=this.exit();return typeof e=="function"?(r=e(r),r&&(r=r.selection())):r=r.append(e+""),t!=null&&(i=t(i),i&&(i=i.selection())),n==null?s.remove():n(s),r&&i?r.merge(i).order():i}function cs(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,i=n.length,s=r.length,o=Math.min(i,s),u=new Array(i),a=0;a<o;++a)for(var c=n[a],l=r[a],f=c.length,h=u[a]=new Array(f),p,b=0;b<f;++b)(p=c[b]||l[b])&&(h[b]=p);for(;a<i;++a)u[a]=n[a];return new ue(u,this._parents)}function ls(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r=e[t],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function fs(e){e||(e=hs);function t(f,h){return f&&h?e(f.__data__,h.__data__):!f-!h}for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o=n[s],u=o.length,a=i[s]=new Array(u),c,l=0;l<u;++l)(c=o[l])&&(a[l]=c);a.sort(t)}return new ue(i,this._parents).order()}function hs(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function ds(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function ps(){return Array.from(this)}function gs(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function vs(){let e=0;for(const t of this)++e;return e}function ys(){return!this.node()}function ms(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i=t[n],s=0,o=i.length,u;s<o;++s)(u=i[s])&&e.call(u,u.__data__,s,i);return this}function ws(e){return function(){this.removeAttribute(e)}}function _s(e){return function(){this.removeAttributeNS(e.space,e.local)}}function bs(e,t){return function(){this.setAttribute(e,t)}}function Es(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function xs(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function Ss(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Cs(e,t){var n=en(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((t==null?n.local?_s:ws:typeof t=="function"?n.local?Ss:xs:n.local?Es:bs)(n,t))}function ri(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function ks(e){return function(){this.style.removeProperty(e)}}function As(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Rs(e,t,n){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function Os(e,t,n){return arguments.length>1?this.each((t==null?ks:typeof t=="function"?Rs:As)(e,t,n??"")):Ge(this.node(),e)}function Ge(e,t){return e.style.getPropertyValue(t)||ri(e).getComputedStyle(e,null).getPropertyValue(t)}function Ms(e){return function(){delete this[e]}}function Ns(e,t){return function(){this[e]=t}}function Ts(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function Ls(e,t){return arguments.length>1?this.each((t==null?Ms:typeof t=="function"?Ts:Ns)(e,t)):this.node()[e]}function ii(e){return e.trim().split(/^|\s+/)}function Fn(e){return e.classList||new oi(e)}function oi(e){this._node=e,this._names=ii(e.getAttribute("class")||"")}oi.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function si(e,t){for(var n=Fn(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function ai(e,t){for(var n=Fn(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function Ps(e){return function(){si(this,e)}}function Bs(e){return function(){ai(this,e)}}function Is(e,t){return function(){(t.apply(this,arguments)?si:ai)(this,e)}}function Hs(e,t){var n=ii(e+"");if(arguments.length<2){for(var r=Fn(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof t=="function"?Is:t?Ps:Bs)(n,t))}function $s(){this.textContent=""}function Ds(e){return function(){this.textContent=e}}function Fs(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Vs(e){return arguments.length?this.each(e==null?$s:(typeof e=="function"?Fs:Ds)(e)):this.node().textContent}function Us(){this.innerHTML=""}function qs(e){return function(){this.innerHTML=e}}function js(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function zs(e){return arguments.length?this.each(e==null?Us:(typeof e=="function"?js:qs)(e)):this.node().innerHTML}function Ks(){this.nextSibling&&this.parentNode.appendChild(this)}function Xs(){return this.each(Ks)}function Ys(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Ws(){return this.each(Ys)}function Gs(e){var t=typeof e=="function"?e:Jr(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function Qs(){return null}function Js(e,t){var n=typeof e=="function"?e:Jr(e),r=t==null?Qs:typeof t=="function"?t:Dn(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function Zs(){var e=this.parentNode;e&&e.removeChild(this)}function ea(){return this.each(Zs)}function ta(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function na(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function ra(e){return this.select(e?na:ta)}function ia(e){return arguments.length?this.property("__data__",e):this.node().__data__}function oa(e){return function(t){e.call(this,t,this.__data__)}}function sa(e){return e.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");return r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),{type:t,name:n}})}function aa(e){return function(){var t=this.__on;if(t){for(var n=0,r=-1,i=t.length,s;n<i;++n)s=t[n],(!e.type||s.type===e.type)&&s.name===e.name?this.removeEventListener(s.type,s.listener,s.options):t[++r]=s;++r?t.length=r:delete this.__on}}}function ua(e,t,n){return function(){var r=this.__on,i,s=oa(t);if(r){for(var o=0,u=r.length;o<u;++o)if((i=r[o]).type===e.type&&i.name===e.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=n),i.value=t;return}}this.addEventListener(e.type,s,n),i={type:e.type,name:e.name,value:t,listener:s,options:n},r?r.push(i):this.__on=[i]}}function ca(e,t,n){var r=sa(e+""),i,s=r.length,o;if(arguments.length<2){var u=this.node().__on;if(u){for(var a=0,c=u.length,l;a<c;++a)for(i=0,l=u[a];i<s;++i)if((o=r[i]).type===l.type&&o.name===l.name)return l.value}return}for(u=t?ua:aa,i=0;i<s;++i)this.each(u(r[i],t,n));return this}function ui(e,t,n){var r=ri(e),i=r.CustomEvent;typeof i=="function"?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function la(e,t){return function(){return ui(this,e,t)}}function fa(e,t){return function(){return ui(this,e,t.apply(this,arguments))}}function ha(e,t){return this.each((typeof t=="function"?fa:la)(e,t))}function*da(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,s=r.length,o;i<s;++i)(o=r[i])&&(yield o)}var ci=[null];function ue(e,t){this._groups=e,this._parents=t}function bt(){return new ue([[document.documentElement]],ci)}function pa(){return this}ue.prototype=bt.prototype={constructor:ue,select:Fo,selectAll:jo,selectChild:Yo,selectChildren:Jo,filter:Zo,data:os,enter:es,exit:as,join:us,merge:cs,selection:pa,order:ls,sort:fs,call:ds,nodes:ps,node:gs,size:vs,empty:ys,each:ms,attr:Cs,style:Os,property:Ls,classed:Hs,text:Vs,html:zs,raise:Xs,lower:Ws,append:Gs,insert:Js,remove:ea,clone:ra,datum:ia,on:ca,dispatch:ha,[Symbol.iterator]:da};function $t(e){return typeof e=="string"?new ue([[document.querySelector(e)]],[document.documentElement]):new ue([[e]],ci)}function Vn(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function li(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Et(){}var yt=.7,Xt=1/yt,Ye="\\s*([+-]?\\d+)\\s*",mt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",_e="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ga=/^#([0-9a-f]{3,8})$/,va=new RegExp(`^rgb\\(${Ye},${Ye},${Ye}\\)$`),ya=new RegExp(`^rgb\\(${_e},${_e},${_e}\\)$`),ma=new RegExp(`^rgba\\(${Ye},${Ye},${Ye},${mt}\\)$`),wa=new RegExp(`^rgba\\(${_e},${_e},${_e},${mt}\\)$`),_a=new RegExp(`^hsl\\(${mt},${_e},${_e}\\)$`),ba=new RegExp(`^hsla\\(${mt},${_e},${_e},${mt}\\)$`),cr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Vn(Et,wt,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:lr,formatHex:lr,formatHex8:Ea,formatHsl:xa,formatRgb:fr,toString:fr});function lr(){return this.rgb().formatHex()}function Ea(){return this.rgb().formatHex8()}function xa(){return fi(this).formatHsl()}function fr(){return this.rgb().formatRgb()}function wt(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=ga.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?hr(t):n===3?new oe(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?Rt(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?Rt(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=va.exec(e))?new oe(t[1],t[2],t[3],1):(t=ya.exec(e))?new oe(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=ma.exec(e))?Rt(t[1],t[2],t[3],t[4]):(t=wa.exec(e))?Rt(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=_a.exec(e))?gr(t[1],t[2]/100,t[3]/100,1):(t=ba.exec(e))?gr(t[1],t[2]/100,t[3]/100,t[4]):cr.hasOwnProperty(e)?hr(cr[e]):e==="transparent"?new oe(NaN,NaN,NaN,0):null}function hr(e){return new oe(e>>16&255,e>>8&255,e&255,1)}function Rt(e,t,n,r){return r<=0&&(e=t=n=NaN),new oe(e,t,n,r)}function Sa(e){return e instanceof Et||(e=wt(e)),e?(e=e.rgb(),new oe(e.r,e.g,e.b,e.opacity)):new oe}function bn(e,t,n,r){return arguments.length===1?Sa(e):new oe(e,t,n,r??1)}function oe(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}Vn(oe,bn,li(Et,{brighter(e){return e=e==null?Xt:Math.pow(Xt,e),new oe(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?yt:Math.pow(yt,e),new oe(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new oe(De(this.r),De(this.g),De(this.b),Yt(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:dr,formatHex:dr,formatHex8:Ca,formatRgb:pr,toString:pr}));function dr(){return`#${Ie(this.r)}${Ie(this.g)}${Ie(this.b)}`}function Ca(){return`#${Ie(this.r)}${Ie(this.g)}${Ie(this.b)}${Ie((isNaN(this.opacity)?1:this.opacity)*255)}`}function pr(){const e=Yt(this.opacity);return`${e===1?"rgb(":"rgba("}${De(this.r)}, ${De(this.g)}, ${De(this.b)}${e===1?")":`, ${e})`}`}function Yt(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function De(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Ie(e){return e=De(e),(e<16?"0":"")+e.toString(16)}function gr(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new ge(e,t,n,r)}function fi(e){if(e instanceof ge)return new ge(e.h,e.s,e.l,e.opacity);if(e instanceof Et||(e=wt(e)),!e)return new ge;if(e instanceof ge)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),s=Math.max(t,n,r),o=NaN,u=s-i,a=(s+i)/2;return u?(t===s?o=(n-r)/u+(n<r)*6:n===s?o=(r-t)/u+2:o=(t-n)/u+4,u/=a<.5?s+i:2-s-i,o*=60):u=a>0&&a<1?0:o,new ge(o,u,a,e.opacity)}function ka(e,t,n,r){return arguments.length===1?fi(e):new ge(e,t,n,r??1)}function ge(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}Vn(ge,ka,li(Et,{brighter(e){return e=e==null?Xt:Math.pow(Xt,e),new ge(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?yt:Math.pow(yt,e),new ge(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new oe(fn(e>=240?e-240:e+120,i,r),fn(e,i,r),fn(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new ge(vr(this.h),Ot(this.s),Ot(this.l),Yt(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Yt(this.opacity);return`${e===1?"hsl(":"hsla("}${vr(this.h)}, ${Ot(this.s)*100}%, ${Ot(this.l)*100}%${e===1?")":`, ${e})`}`}}));function vr(e){return e=(e||0)%360,e<0?e+360:e}function Ot(e){return Math.max(0,Math.min(1,e||0))}function fn(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const hi=e=>()=>e;function Aa(e,t){return function(n){return e+n*t}}function Ra(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function Oa(e){return(e=+e)==1?di:function(t,n){return n-t?Ra(t,n,e):hi(isNaN(t)?n:t)}}function di(e,t){var n=t-e;return n?Aa(e,n):hi(isNaN(e)?t:e)}const yr=function e(t){var n=Oa(t);function r(i,s){var o=n((i=bn(i)).r,(s=bn(s)).r),u=n(i.g,s.g),a=n(i.b,s.b),c=di(i.opacity,s.opacity);return function(l){return i.r=o(l),i.g=u(l),i.b=a(l),i.opacity=c(l),i+""}}return r.gamma=e,r}(1);function Me(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var En=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,hn=new RegExp(En.source,"g");function Ma(e){return function(){return e}}function Na(e){return function(t){return e(t)+""}}function Ta(e,t){var n=En.lastIndex=hn.lastIndex=0,r,i,s,o=-1,u=[],a=[];for(e=e+"",t=t+"";(r=En.exec(e))&&(i=hn.exec(t));)(s=i.index)>n&&(s=t.slice(n,s),u[o]?u[o]+=s:u[++o]=s),(r=r[0])===(i=i[0])?u[o]?u[o]+=i:u[++o]=i:(u[++o]=null,a.push({i:o,x:Me(r,i)})),n=hn.lastIndex;return n<t.length&&(s=t.slice(n),u[o]?u[o]+=s:u[++o]=s),u.length<2?a[0]?Na(a[0].x):Ma(t):(t=a.length,function(c){for(var l=0,f;l<t;++l)u[(f=a[l]).i]=f.x(c);return u.join("")})}var mr=180/Math.PI,xn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function pi(e,t,n,r,i,s){var o,u,a;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(a=e*n+t*r)&&(n-=e*a,r-=t*a),(u=Math.sqrt(n*n+r*r))&&(n/=u,r/=u,a/=u),e*r<t*n&&(e=-e,t=-t,a=-a,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(t,e)*mr,skewX:Math.atan(a)*mr,scaleX:o,scaleY:u}}var Mt;function La(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?xn:pi(t.a,t.b,t.c,t.d,t.e,t.f)}function Pa(e){return e==null||(Mt||(Mt=document.createElementNS("http://www.w3.org/2000/svg","g")),Mt.setAttribute("transform",e),!(e=Mt.transform.baseVal.consolidate()))?xn:(e=e.matrix,pi(e.a,e.b,e.c,e.d,e.e,e.f))}function gi(e,t,n,r){function i(c){return c.length?c.pop()+" ":""}function s(c,l,f,h,p,b){if(c!==f||l!==h){var C=p.push("translate(",null,t,null,n);b.push({i:C-4,x:Me(c,f)},{i:C-2,x:Me(l,h)})}else(f||h)&&p.push("translate("+f+t+h+n)}function o(c,l,f,h){c!==l?(c-l>180?l+=360:l-c>180&&(c+=360),h.push({i:f.push(i(f)+"rotate(",null,r)-2,x:Me(c,l)})):l&&f.push(i(f)+"rotate("+l+r)}function u(c,l,f,h){c!==l?h.push({i:f.push(i(f)+"skewX(",null,r)-2,x:Me(c,l)}):l&&f.push(i(f)+"skewX("+l+r)}function a(c,l,f,h,p,b){if(c!==f||l!==h){var C=p.push(i(p)+"scale(",null,",",null,")");b.push({i:C-4,x:Me(c,f)},{i:C-2,x:Me(l,h)})}else(f!==1||h!==1)&&p.push(i(p)+"scale("+f+","+h+")")}return function(c,l){var f=[],h=[];return c=e(c),l=e(l),s(c.translateX,c.translateY,l.translateX,l.translateY,f,h),o(c.rotate,l.rotate,f,h),u(c.skewX,l.skewX,f,h),a(c.scaleX,c.scaleY,l.scaleX,l.scaleY,f,h),c=l=null,function(p){for(var b=-1,C=h.length,H;++b<C;)f[(H=h[b]).i]=H.x(p);return f.join("")}}}var Ba=gi(La,"px, ","px)","deg)"),Ia=gi(Pa,", ",")",")"),Qe=0,lt=0,st=0,vi=1e3,Wt,ft,Gt=0,Ve=0,tn=0,_t=typeof performance=="object"&&performance.now?performance:Date,yi=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Un(){return Ve||(yi(Ha),Ve=_t.now()+tn)}function Ha(){Ve=0}function Qt(){this._call=this._time=this._next=null}Qt.prototype=mi.prototype={constructor:Qt,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?Un():+n)+(t==null?0:+t),!this._next&&ft!==this&&(ft?ft._next=this:Wt=this,ft=this),this._call=e,this._time=n,Sn()},stop:function(){this._call&&(this._call=null,this._time=1/0,Sn())}};function mi(e,t,n){var r=new Qt;return r.restart(e,t,n),r}function $a(){Un(),++Qe;for(var e=Wt,t;e;)(t=Ve-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Qe}function wr(){Ve=(Gt=_t.now())+tn,Qe=lt=0;try{$a()}finally{Qe=0,Fa(),Ve=0}}function Da(){var e=_t.now(),t=e-Gt;t>vi&&(tn-=t,Gt=e)}function Fa(){for(var e,t=Wt,n,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Wt=n);ft=e,Sn(r)}function Sn(e){if(!Qe){lt&&(lt=clearTimeout(lt));var t=e-Ve;t>24?(e<1/0&&(lt=setTimeout(wr,e-_t.now()-tn)),st&&(st=clearInterval(st))):(st||(Gt=_t.now(),st=setInterval(Da,vi)),Qe=1,yi(wr))}}function _r(e,t,n){var r=new Qt;return t=t==null?0:+t,r.restart(i=>{r.stop(),e(i+t)},t,n),r}var Va=Qr("start","end","cancel","interrupt"),Ua=[],wi=0,br=1,Cn=2,Dt=3,Er=4,kn=5,Ft=6;function nn(e,t,n,r,i,s){var o=e.__transition;if(!o)e.__transition={};else if(n in o)return;qa(e,n,{name:t,index:r,group:i,on:Va,tween:Ua,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:wi})}function qn(e,t){var n=ye(e,t);if(n.state>wi)throw new Error("too late; already scheduled");return n}function xe(e,t){var n=ye(e,t);if(n.state>Dt)throw new Error("too late; already running");return n}function ye(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function qa(e,t,n){var r=e.__transition,i;r[t]=n,n.timer=mi(s,0,n.time);function s(c){n.state=br,n.timer.restart(o,n.delay,n.time),n.delay<=c&&o(c-n.delay)}function o(c){var l,f,h,p;if(n.state!==br)return a();for(l in r)if(p=r[l],p.name===n.name){if(p.state===Dt)return _r(o);p.state===Er?(p.state=Ft,p.timer.stop(),p.on.call("interrupt",e,e.__data__,p.index,p.group),delete r[l]):+l<t&&(p.state=Ft,p.timer.stop(),p.on.call("cancel",e,e.__data__,p.index,p.group),delete r[l])}if(_r(function(){n.state===Dt&&(n.state=Er,n.timer.restart(u,n.delay,n.time),u(c))}),n.state=Cn,n.on.call("start",e,e.__data__,n.index,n.group),n.state===Cn){for(n.state=Dt,i=new Array(h=n.tween.length),l=0,f=-1;l<h;++l)(p=n.tween[l].value.call(e,e.__data__,n.index,n.group))&&(i[++f]=p);i.length=f+1}}function u(c){for(var l=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(a),n.state=kn,1),f=-1,h=i.length;++f<h;)i[f].call(e,l);n.state===kn&&(n.on.call("end",e,e.__data__,n.index,n.group),a())}function a(){n.state=Ft,n.timer.stop(),delete r[t];for(var c in r)return;delete e.__transition}}function ja(e,t){var n=e.__transition,r,i,s=!0,o;if(n){t=t==null?null:t+"";for(o in n){if((r=n[o]).name!==t){s=!1;continue}i=r.state>Cn&&r.state<kn,r.state=Ft,r.timer.stop(),r.on.call(i?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete n[o]}s&&delete e.__transition}}function za(e){return this.each(function(){ja(this,e)})}function Ka(e,t){var n,r;return function(){var i=xe(this,e),s=i.tween;if(s!==n){r=n=s;for(var o=0,u=r.length;o<u;++o)if(r[o].name===t){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function Xa(e,t,n){var r,i;if(typeof n!="function")throw new Error;return function(){var s=xe(this,e),o=s.tween;if(o!==r){i=(r=o).slice();for(var u={name:t,value:n},a=0,c=i.length;a<c;++a)if(i[a].name===t){i[a]=u;break}a===c&&i.push(u)}s.tween=i}}function Ya(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r=ye(this.node(),n).tween,i=0,s=r.length,o;i<s;++i)if((o=r[i]).name===e)return o.value;return null}return this.each((t==null?Ka:Xa)(n,e,t))}function jn(e,t,n){var r=e._id;return e.each(function(){var i=xe(this,r);(i.value||(i.value={}))[t]=n.apply(this,arguments)}),function(i){return ye(i,r).value[t]}}function _i(e,t){var n;return(typeof t=="number"?Me:t instanceof wt?yr:(n=wt(t))?(t=n,yr):Ta)(e,t)}function Wa(e){return function(){this.removeAttribute(e)}}function Ga(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Qa(e,t,n){var r,i=n+"",s;return function(){var o=this.getAttribute(e);return o===i?null:o===r?s:s=t(r=o,n)}}function Ja(e,t,n){var r,i=n+"",s;return function(){var o=this.getAttributeNS(e.space,e.local);return o===i?null:o===r?s:s=t(r=o,n)}}function Za(e,t,n){var r,i,s;return function(){var o,u=n(this),a;return u==null?void this.removeAttribute(e):(o=this.getAttribute(e),a=u+"",o===a?null:o===r&&a===i?s:(i=a,s=t(r=o,u)))}}function eu(e,t,n){var r,i,s;return function(){var o,u=n(this),a;return u==null?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local),a=u+"",o===a?null:o===r&&a===i?s:(i=a,s=t(r=o,u)))}}function tu(e,t){var n=en(e),r=n==="transform"?Ia:_i;return this.attrTween(e,typeof t=="function"?(n.local?eu:Za)(n,r,jn(this,"attr."+e,t)):t==null?(n.local?Ga:Wa)(n):(n.local?Ja:Qa)(n,r,t))}function nu(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function ru(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function iu(e,t){var n,r;function i(){var s=t.apply(this,arguments);return s!==r&&(n=(r=s)&&ru(e,s)),n}return i._value=t,i}function ou(e,t){var n,r;function i(){var s=t.apply(this,arguments);return s!==r&&(n=(r=s)&&nu(e,s)),n}return i._value=t,i}function su(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var r=en(e);return this.tween(n,(r.local?iu:ou)(r,t))}function au(e,t){return function(){qn(this,e).delay=+t.apply(this,arguments)}}function uu(e,t){return t=+t,function(){qn(this,e).delay=t}}function cu(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?au:uu)(t,e)):ye(this.node(),t).delay}function lu(e,t){return function(){xe(this,e).duration=+t.apply(this,arguments)}}function fu(e,t){return t=+t,function(){xe(this,e).duration=t}}function hu(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?lu:fu)(t,e)):ye(this.node(),t).duration}function du(e,t){if(typeof t!="function")throw new Error;return function(){xe(this,e).ease=t}}function pu(e){var t=this._id;return arguments.length?this.each(du(t,e)):ye(this.node(),t).ease}function gu(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;xe(this,e).ease=n}}function vu(e){if(typeof e!="function")throw new Error;return this.each(gu(this._id,e))}function yu(e){typeof e!="function"&&(e=ei(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s=t[i],o=s.length,u=r[i]=[],a,c=0;c<o;++c)(a=s[c])&&e.call(a,a.__data__,c,s)&&u.push(a);return new Ae(r,this._parents,this._name,this._id)}function mu(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,i=n.length,s=Math.min(r,i),o=new Array(r),u=0;u<s;++u)for(var a=t[u],c=n[u],l=a.length,f=o[u]=new Array(l),h,p=0;p<l;++p)(h=a[p]||c[p])&&(f[p]=h);for(;u<r;++u)o[u]=t[u];return new Ae(o,this._parents,this._name,this._id)}function wu(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function _u(e,t,n){var r,i,s=wu(t)?qn:xe;return function(){var o=s(this,e),u=o.on;u!==r&&(i=(r=u).copy()).on(t,n),o.on=i}}function bu(e,t){var n=this._id;return arguments.length<2?ye(this.node(),n).on.on(e):this.each(_u(n,e,t))}function Eu(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function xu(){return this.on("end.remove",Eu(this._id))}function Su(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Dn(e));for(var r=this._groups,i=r.length,s=new Array(i),o=0;o<i;++o)for(var u=r[o],a=u.length,c=s[o]=new Array(a),l,f,h=0;h<a;++h)(l=u[h])&&(f=e.call(l,l.__data__,h,u))&&("__data__"in l&&(f.__data__=l.__data__),c[h]=f,nn(c[h],t,n,h,c,ye(l,n)));return new Ae(s,this._parents,t,n)}function Cu(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Zr(e));for(var r=this._groups,i=r.length,s=[],o=[],u=0;u<i;++u)for(var a=r[u],c=a.length,l,f=0;f<c;++f)if(l=a[f]){for(var h=e.call(l,l.__data__,f,a),p,b=ye(l,n),C=0,H=h.length;C<H;++C)(p=h[C])&&nn(p,t,n,C,h,b);s.push(h),o.push(l)}return new Ae(s,o,t,n)}var ku=bt.prototype.constructor;function Au(){return new ku(this._groups,this._parents)}function Ru(e,t){var n,r,i;return function(){var s=Ge(this,e),o=(this.style.removeProperty(e),Ge(this,e));return s===o?null:s===n&&o===r?i:i=t(n=s,r=o)}}function bi(e){return function(){this.style.removeProperty(e)}}function Ou(e,t,n){var r,i=n+"",s;return function(){var o=Ge(this,e);return o===i?null:o===r?s:s=t(r=o,n)}}function Mu(e,t,n){var r,i,s;return function(){var o=Ge(this,e),u=n(this),a=u+"";return u==null&&(a=u=(this.style.removeProperty(e),Ge(this,e))),o===a?null:o===r&&a===i?s:(i=a,s=t(r=o,u))}}function Nu(e,t){var n,r,i,s="style."+t,o="end."+s,u;return function(){var a=xe(this,e),c=a.on,l=a.value[s]==null?u||(u=bi(t)):void 0;(c!==n||i!==l)&&(r=(n=c).copy()).on(o,i=l),a.on=r}}function Tu(e,t,n){var r=(e+="")=="transform"?Ba:_i;return t==null?this.styleTween(e,Ru(e,r)).on("end.style."+e,bi(e)):typeof t=="function"?this.styleTween(e,Mu(e,r,jn(this,"style."+e,t))).each(Nu(this._id,e)):this.styleTween(e,Ou(e,r,t),n).on("end.style."+e,null)}function Lu(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}function Pu(e,t,n){var r,i;function s(){var o=t.apply(this,arguments);return o!==i&&(r=(i=o)&&Lu(e,o,n)),r}return s._value=t,s}function Bu(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,Pu(e,t,n??""))}function Iu(e){return function(){this.textContent=e}}function Hu(e){return function(){var t=e(this);this.textContent=t??""}}function $u(e){return this.tween("text",typeof e=="function"?Hu(jn(this,"text",e)):Iu(e==null?"":e+""))}function Du(e){return function(t){this.textContent=e.call(this,t)}}function Fu(e){var t,n;function r(){var i=e.apply(this,arguments);return i!==n&&(t=(n=i)&&Du(i)),t}return r._value=e,r}function Vu(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Fu(e))}function Uu(){for(var e=this._name,t=this._id,n=Ei(),r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],u=o.length,a,c=0;c<u;++c)if(a=o[c]){var l=ye(a,t);nn(a,e,n,c,o,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new Ae(r,this._parents,e,n)}function qu(){var e,t,n=this,r=n._id,i=n.size();return new Promise(function(s,o){var u={value:o},a={value:function(){--i===0&&s()}};n.each(function(){var c=xe(this,r),l=c.on;l!==e&&(t=(e=l).copy(),t._.cancel.push(u),t._.interrupt.push(u),t._.end.push(a)),c.on=t}),i===0&&s()})}var ju=0;function Ae(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function Ei(){return++ju}var ke=bt.prototype;Ae.prototype={constructor:Ae,select:Su,selectAll:Cu,selectChild:ke.selectChild,selectChildren:ke.selectChildren,filter:yu,merge:mu,selection:Au,transition:Uu,call:ke.call,nodes:ke.nodes,node:ke.node,size:ke.size,empty:ke.empty,each:ke.each,on:bu,attr:tu,attrTween:su,style:Tu,styleTween:Bu,text:$u,textTween:Vu,remove:xu,tween:Ya,delay:cu,duration:hu,ease:pu,easeVarying:vu,end:qu,[Symbol.iterator]:ke[Symbol.iterator]};function zu(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Ku={time:null,delay:0,duration:250,ease:zu};function Xu(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function Yu(e){var t,n;e instanceof Ae?(t=e._id,e=e._name):(t=Ei(),(n=Ku).time=Un(),e=e==null?null:e+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],u=o.length,a,c=0;c<u;++c)(a=o[c])&&nn(a,e,t,c,o,n||Xu(a,t));return new Ae(r,this._parents,e,t)}bt.prototype.interrupt=za;bt.prototype.transition=Yu;function ht(e,t,n){this.k=e,this.x=t,this.y=n}ht.prototype={constructor:ht,scale:function(e){return e===1?this:new ht(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new ht(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};ht.prototype;const I=he(),xr=Zt();function rn(){const r="1400px",i="700px";let s=[];function o(v){return v?"red":"transparent"}function u(){return`${I.getRectSize()/25}em`}function a(v){return window.getComputedStyle(v,null).getPropertyValue("font-size")}function c(){return`${I.getRectSize()/50}em`}function l(){return`${I.getRectSize()/28}em`}function f(v){var V,K;let R=(V=document.getElementById(v))==null?void 0:V.clientWidth,E=(K=document.getElementById(v))==null?void 0:K.clientHeight;!R||!E||I.setRectSize(Math.min(Math.floor(R/35),Math.floor(E/20)))}function h(v){let R=document.createElement("canvas");window.textMeasurementCtx=R.getContext("2d"),window.textMeasurementCtx.font=window.getComputedStyle(v,null).getPropertyValue("font")}function p(v){return window.textMeasurementCtx.measureText(v).width/I.getRectSize()}function b(v){return to()*v.split(/\r*\n/).length/I.getRectSize()}function C(v){const R=document.getElementById(v);if(R){f(v),h(R);for(var E=0;E<20;E++)s.push(Lo(35));$t("#"+v).selectAll("g").data(s).enter().append("g").attr("row",(V,K)=>K).lower().attr("transform",(V,K)=>"translate(0, "+I.getRectSize()*K+")").selectAll("rect").data(V=>V).enter().append("rect").attr("fill",(V,K,te)=>"white").attr("stroke-opacity",1).attr("stroke","lightgray").attr("col",(V,K)=>K).attr("x",(V,K)=>K*I.getRectSize()).attr("width",I.getRectSize()).attr("height",I.getRectSize())}}function H(v,R){var ot,nr,rr,ir;if(((ot=I.activeCell)==null?void 0:ot.col)==null||!((nr=I.activeCell)!=null&&nr.row)==null)return;let E=(rr=I.activeCell)==null?void 0:rr.col,V=(ir=I.activeCell)==null?void 0:ir.row,K=E,te=V;return E+v<35&&E+v>=0&&(K+=v),E+v>=35&&V!=20&&(te+=1,K=0),V+R<20&&V+R>=0&&(te+=R),(V+R>=20||V+R<0)&&(K=0,te=0),{col:K,row:te}}function T(v,R){let E=H(v,R);E&&(E.notationType="rect",I.setActiveCell(E))}function A(v){var R;return(R=document==null?void 0:document.querySelector(`g[row='${v.row}']`))==null?void 0:R.querySelector(`rect[col='${v.col}']`)}function N(v){let R=[];for(const E in v)if(Object.hasOwnProperty.call(v,E)){const V=v[E];if(R.push(V),V.notationType==="SQRT"){let K={...V};K.notationType="SQRTSYMBOL",R.push(K)}}return R}function O(v,R,E){try{v=N(v)}catch{}$t("#"+R).selectAll("foreignObject").data(Object.values(v)).join(V=>x(V,E),V=>J(V),V=>Y(V))}function m(v){switch(Be.get(v.notationType)){case"POINT":return P();case"LINE":return j();case"RECT":return z(v)}return null}function x(v,R){return v.append("foreignObject").attr("type",E=>E.notationType).attr("id",E=>S(E)).attr("col",E=>E==null?void 0:E.col).attr("fromCol",E=>E==null?void 0:E.fromCol).attr("toCol",E=>E==null?void 0:E.toCol).attr("row",E=>E==null?void 0:E.row).attr("fromRow",E=>E==null?void 0:E.fromRow).attr("toRow",E=>E==null?void 0:E.toRow).attr("x",E=>U(E)).attr("y",E=>F(E)).attr("width",E=>ee(E)).attr("height",E=>m(E)).style("font-size",E=>$(E,R)).html(E=>Se(E))}function J(v){return v.attr("x",R=>U(R)).attr("y",R=>F(R)).attr("col",R=>L(R)).attr("row",R=>w(R)).attr("width",R=>ee(R)).html(R=>Se(R))}function Y(v){return v.transition().duration(10).attr("r",0).style("opacity",0).attr("cx",1e3).on("end",()=>{$t(this).remove()})}function S(v){return v.notationType+v.uuid}function L(v){switch(Be.get(v.notationType)){case"POINT":return v.col;case"LINE":case"RECT":return v.fromCol}return null}function w(v){switch(Be.get(v.notationType)){case"POINT":case"LINE":return v.row;case"RECT":return v.fromRow}return null}function U(v){let R=L(v),E=v.notationType==="SQRTSYMBOL"||v.notationType==="POWER"?Math.round(I.getRectSize()/3)*-1:0;return R?kt(R)+E:null}function F(v){let R=w(v);if(!R)return null;let E=v.notationType==="POWER"?-5:v.notationType==="FRACTION"||v.notationType==="SQRT"||v.notationType==="SQRTSYMBOL"?-4:0;return it(R)+E}function ee(v){if(v.notationType==="SQRTSYMBOL")return I.getRectSize();switch(Be.get(v.notationType)){case"POINT":return d();case"LINE":return g(v);case"RECT":return y(v)}return null}function d(v){return I.getRectSize()}function g(v){return(v.toCol-v.fromCol)*I.getRectSize()+5}function y(v){return(v.toCol-v.fromCol)*I.getRectSize()+5}function P(v){return I.getRectSize()}function j(v){return I.getRectSize()}function z(v){return(v.toRow-v.fromRow)*I.getRectSize()+5}function $(v,R){return v.notationType==="POWER"?c():v.notationType==="TEXT"?a(R):v.notationType==="SIGN"?l():u}function Se(v){var K;if(v.notationType==="FRACTION"){let te=v;return`<span class=line style='width:${(te.toCol-te.fromCol)*I.getRectSize()}px;'></span>`}if(v.notationType==="SQRT"){let te=v;return`<span class=line style='position:relative;left:9px;width:${(te.toCol-te.fromCol)*I.getRectSize()-8}px;'></span>`}if(v.notationType==="SQRTSYMBOL")return"<p class='sqrtsymbol'>&#x221A;</p>";if(v.notationType==="TEXT"){let te=v,ot=o(v===I.activeNotation);return`<pre style='border:groove 2px;border-color:${ot};background-color:${ot}'>${te.value}</pre>`}if(v.notationType==="IMAGE"){let te=v;return o(v===I.activeNotation),`<img style='border:groove 2px;border-color:${o}' src='${te.value}'>`}let R=v,E=((K=xr.getCurrentUser())==null?void 0:K.uuid)==v.user.uuid?"bold":"normal";return`<p style='color:${Array.from(I.getSelectedNotations()).map(te=>te.uuid).indexOf(v.uuid)>=0?"red":I.getParent().value.type==="ANSWER"&&xr.getCurrentUser().uuid!=v.user.uuid?"purple":"black"};font-weight:${E};margin-left:8px;font-size:1.1em'>${R.value}</p>`}function kt(v){return v*I.getRectSize()}function it(v){return v*I.getRectSize()}function At(){return I.getRectSize()}return{svgWidth:r,svgHeight:i,setMatrix:C,showNotations:x,getRectSize:At,findRect:A,setNextRect:T,freeTextRectWidth:p,freeTextRectHeight:b,getNotationXposByCol:kt,getNotationYposByRow:it,refreshScreen:O}}function Wu(){function e(i,s,o){for(var u=[],a=[],c=document.elementFromPoint(i.x,i.y),l=null,f=0;f++<50&&c&&(!l||c!=l)&&c!=document.body&&c!=window&&c!=document&&c!=document.documentElement;)u.push(c),a.push(c.style.display),c.style.display="none",l=c,c=document.elementFromPoint(i.x,i.y);for(var h=0;h<u.length;h++)u[h].style.display=a[h];return u.find(p=>{var b;return p.tagName==s&&(!o||(o==null?void 0:o.includes((b=p.attributes.type)==null?void 0:b.value)))})}function t(i){return e({x:i.clientX,y:i.clientY},"foreignObject",["TEXT","GEO","IMAGE"])}function n(i){return e({x:i.clientX,y:i.clientY},"foreignObject",mn)}function r(i,s){var u;let o=(u=i.attributes.getNamedItem(s))==null?void 0:u.value;return o?Number.parseInt(o):-1}return{findClickedObject:e,getElementAttributeValue:r,findRectAtClickedPosition:t,findNotationAtClickedPosition:n}}var An={exports:{}},xt={},Ne={};Object.defineProperty(Ne,"__esModule",{value:!0});Ne.createDebug=Ne.setDebug=Ne.noopDebug=void 0;const gt={};function xi(){return function(){}}Ne.noopDebug=xi;let Si=xi;function Gu(e){Si=e,Object.keys(gt).forEach(t=>{gt[t]=e(t)})}Ne.setDebug=Gu;function Qu(e){return gt[e]||(gt[e]=Si(e)),(...t)=>gt[e](...t)}Ne.createDebug=Qu;(function(e){var t=ne&&ne.__createBinding||(Object.create?function(o,u,a,c){c===void 0&&(c=a);var l=Object.getOwnPropertyDescriptor(u,a);(!l||("get"in l?!u.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return u[a]}}),Object.defineProperty(o,c,l)}:function(o,u,a,c){c===void 0&&(c=a),o[c]=u[a]}),n=ne&&ne.__exportStar||function(o,u){for(var a in o)a!=="default"&&!Object.prototype.hasOwnProperty.call(u,a)&&t(u,o,a)};Object.defineProperty(e,"__esModule",{value:!0}),e.createSymbol=e.isPromise=e._=e.stripSlashes=void 0;function r(o){return o.replace(/^(\/+)|(\/+)$/g,"")}e.stripSlashes=r,e._={each(o,u){o&&typeof o.forEach=="function"?o.forEach(u):e._.isObject(o)&&Object.keys(o).forEach(a=>u(o[a],a))},some(o,u){return Object.keys(o).map(a=>[o[a],a]).some(([a,c])=>u(a,c))},every(o,u){return Object.keys(o).map(a=>[o[a],a]).every(([a,c])=>u(a,c))},keys(o){return Object.keys(o)},values(o){return e._.keys(o).map(u=>o[u])},isMatch(o,u){return e._.keys(u).every(a=>o[a]===u[a])},isEmpty(o){return e._.keys(o).length===0},isObject(o){return typeof o=="object"&&!Array.isArray(o)&&o!==null},isObjectOrArray(o){return typeof o=="object"&&o!==null},extend(o,...u){return Object.assign(o,...u)},omit(o,...u){const a=e._.extend({},o);return u.forEach(c=>delete a[c]),a},pick(o,...u){return u.reduce((a,c)=>(o[c]!==void 0&&(a[c]=o[c]),a),{})},merge(o,u){return e._.isObject(o)&&e._.isObject(u)&&Object.keys(u).forEach(a=>{e._.isObject(u[a])?(o[a]||Object.assign(o,{[a]:{}}),e._.merge(o[a],u[a])):Object.assign(o,{[a]:u[a]})}),o}};function i(o){return e._.isObject(o)&&typeof o.then=="function"}e.isPromise=i;function s(o){return typeof Symbol<"u"?Symbol.for(o):o}e.createSymbol=s,n(Ne,e)})(xt);var on={};Object.defineProperty(on,"__esModule",{value:!0});on.default="5.0.8";var sn={},zn={exports:{}},We=typeof Reflect=="object"?Reflect:null,Sr=We&&typeof We.apply=="function"?We.apply:function(t,n,r){return Function.prototype.apply.call(t,n,r)},Vt;We&&typeof We.ownKeys=="function"?Vt=We.ownKeys:Object.getOwnPropertySymbols?Vt=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Vt=function(t){return Object.getOwnPropertyNames(t)};function Ju(e){console&&console.warn&&console.warn(e)}var Ci=Number.isNaN||function(t){return t!==t};function D(){D.init.call(this)}zn.exports=D;zn.exports.once=nc;D.EventEmitter=D;D.prototype._events=void 0;D.prototype._eventsCount=0;D.prototype._maxListeners=void 0;var Cr=10;function an(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(D,"defaultMaxListeners",{enumerable:!0,get:function(){return Cr},set:function(e){if(typeof e!="number"||e<0||Ci(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Cr=e}});D.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};D.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Ci(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function ki(e){return e._maxListeners===void 0?D.defaultMaxListeners:e._maxListeners}D.prototype.getMaxListeners=function(){return ki(this)};D.prototype.emit=function(t){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=t==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(n.length>0&&(o=n[0]),o instanceof Error)throw o;var u=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw u.context=o,u}var a=s[t];if(a===void 0)return!1;if(typeof a=="function")Sr(a,this,n);else for(var c=a.length,l=Ni(a,c),r=0;r<c;++r)Sr(l[r],this,n);return!0};function Ai(e,t,n,r){var i,s,o;if(an(n),s=e._events,s===void 0?(s=e._events=Object.create(null),e._eventsCount=0):(s.newListener!==void 0&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),o=s[t]),o===void 0)o=s[t]=n,++e._eventsCount;else if(typeof o=="function"?o=s[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),i=ki(e),i>0&&o.length>i&&!o.warned){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,Ju(u)}return e}D.prototype.addListener=function(t,n){return Ai(this,t,n,!1)};D.prototype.on=D.prototype.addListener;D.prototype.prependListener=function(t,n){return Ai(this,t,n,!0)};function Zu(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Ri(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=Zu.bind(r);return i.listener=n,r.wrapFn=i,i}D.prototype.once=function(t,n){return an(n),this.on(t,Ri(this,t,n)),this};D.prototype.prependOnceListener=function(t,n){return an(n),this.prependListener(t,Ri(this,t,n)),this};D.prototype.removeListener=function(t,n){var r,i,s,o,u;if(an(n),i=this._events,i===void 0)return this;if(r=i[t],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||n));else if(typeof r!="function"){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===n||r[o].listener===n){u=r[o].listener,s=o;break}if(s<0)return this;s===0?r.shift():ec(r,s),r.length===1&&(i[t]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",t,u||n)}return this};D.prototype.off=D.prototype.removeListener;D.prototype.removeAllListeners=function(t){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[t]),this;if(arguments.length===0){var s=Object.keys(r),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[t],typeof n=="function")this.removeListener(t,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(t,n[i]);return this};function Oi(e,t,n){var r=e._events;if(r===void 0)return[];var i=r[t];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?tc(i):Ni(i,i.length)}D.prototype.listeners=function(t){return Oi(this,t,!0)};D.prototype.rawListeners=function(t){return Oi(this,t,!1)};D.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):Mi.call(e,t)};D.prototype.listenerCount=Mi;function Mi(e){var t=this._events;if(t!==void 0){var n=t[e];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}D.prototype.eventNames=function(){return this._eventsCount>0?Vt(this._events):[]};function Ni(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function ec(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function tc(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function nc(e,t){return new Promise(function(n,r){function i(o){e.removeListener(t,s),r(o)}function s(){typeof e.removeListener=="function"&&e.removeListener("error",i),n([].slice.call(arguments))}Ti(e,t,s,{once:!0}),t!=="error"&&rc(e,i,{once:!0})})}function rc(e,t,n){typeof e.on=="function"&&Ti(e,"error",t,n)}function Ti(e,t,n,r){if(typeof e.on=="function")r.once?e.once(t,n):e.on(t,n);else if(typeof e.addEventListener=="function")e.addEventListener(t,function i(s){r.once&&e.removeEventListener(t,i),n(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var Kn=zn.exports,Xn={},Jt={},Ue={};Object.defineProperty(Ue,"__esModule",{value:!0});Ue.copyFnProperties=Ue.copyProperties=void 0;function ic(e,...t){for(const n of t){const r=Object.keys(n).concat(Object.getOwnPropertySymbols(n));for(const i of r){const s=Object.getOwnPropertyDescriptor(n,i);s&&!Object.prototype.hasOwnProperty.call(e,i)&&Object.defineProperty(e,i,s)}}return e}Ue.copyProperties=ic;function oc(e,t){const n=["name","length"];try{for(const r of n){const i=t[r];Object.defineProperty(e,r,{value:i})}}catch{}return e}Ue.copyFnProperties=oc;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.setMiddleware=e.getMiddleware=e.setManager=e.getManager=e.convertOptions=e.HookManager=e.BaseHookContext=e.HOOKS=void 0;const t=Ue;e.HOOKS=Symbol("@feathersjs/hooks");class n{constructor(l={}){Object.defineProperty(this,"self",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.assign(this,l)}toJSON(){const l=Object.keys(this);let f=Object.getPrototypeOf(this);for(;f;)l.push(...Object.keys(f)),f=Object.getPrototypeOf(f);return l.reduce((h,p)=>(h[p]=this[p],h),{})}}e.BaseHookContext=n;class r{constructor(){Object.defineProperty(this,"_parent",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_params",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_middleware",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_props",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_defaults",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}parent(l){return this._parent=l,this}middleware(l){return this._middleware=l!=null&&l.length?l:null,this}getMiddleware(){var f;const l=(f=this._parent)==null?void 0:f.getMiddleware();return l&&this._middleware?l.concat(this._middleware):l||this._middleware}collectMiddleware(l,f){const h=u(l),p=this.getMiddleware();return h&&p?h.concat(p):h||p||[]}props(l){return this._props||(this._props={}),(0,t.copyProperties)(this._props,l),this}getProps(){var f;const l=(f=this._parent)==null?void 0:f.getProps();return l&&this._props?(0,t.copyProperties)({},l,this._props):l||this._props||null}params(...l){return this._params=l,this}getParams(){var f;const l=(f=this._parent)==null?void 0:f.getParams();return l&&this._params?l.concat(this._params):l||this._params}defaults(l){return this._defaults=l,this}getDefaults(l,f,h){var C;const p=typeof this._defaults=="function"?this._defaults(l,f,h):null,b=(C=this._parent)==null?void 0:C.getDefaults(l,f,h);return b&&p?Object.assign({},b,p):b||p}getContextClass(l=n){const f=class extends l{constructor(C){super(C)}},h=this.getParams(),p=this.getProps();return h&&h.forEach((b,C)=>{if((p==null?void 0:p[b])!==void 0)throw new Error(`Hooks can not have a property and param named '${b}'. Use .defaults instead.`);Object.defineProperty(f.prototype,b,{enumerable:!0,get(){return this==null?void 0:this.arguments[C]},set(H){this.arguments[C]=H}})}),p&&(0,t.copyProperties)(f.prototype,p),f}initializeContext(l,f,h){const p=this._parent?this._parent.initializeContext(l,f,h):h,b=this.getDefaults(l,f,p);if(l&&(p.self=l),p.arguments=f,b)for(const C of Object.keys(b))p[C]===void 0&&(p[C]=b[C]);return p}}e.HookManager=r;function i(c=null){return c?Array.isArray(c)?new r().middleware(c):c:new r}e.convertOptions=i;function s(c){return c&&c[e.HOOKS]||null}e.getManager=s;function o(c,l){const f=s(c);return c[e.HOOKS]=l.parent(f),c}e.setManager=o;function u(c){const l=s(c);return l?l.getMiddleware():null}e.getMiddleware=u;function a(c,l){const f=new r().middleware(l);return o(c,f)}e.setMiddleware=a})(Jt);var ve={},nt={};Object.defineProperty(nt,"__esModule",{value:!0});nt.compose=void 0;function sc(e){if(!Array.isArray(e))throw new TypeError("Middleware stack must be an array!");for(const t of e)if(typeof t!="function")throw new TypeError("Middleware must be composed of functions!");return function(t,n){let r=-1;return i.call(this,0);function i(s){if(s<=r)return Promise.reject(new Error("next() called multiple times"));r=s;let o=e[s];if(s===e.length&&(o=n),!o)return Promise.resolve();try{return Promise.resolve(o.call(this,t,i.bind(this,s+1)))}catch(u){return Promise.reject(u)}}}}nt.compose=sc;Object.defineProperty(ve,"__esModule",{value:!0});ve.hookDecorator=ve.objectHooks=ve.functionHooks=ve.getOriginal=void 0;const ac=nt,Je=Jt,kr=Ue;function Yn(e){return typeof e.original=="function"?Yn(e.original):e}ve.getOriginal=Yn;function Wn(e,t){if(typeof e!="function")throw new Error("Can not apply hooks to non-function");const n=(0,Je.convertOptions)(t),r=function(...i){const{Context:s,original:o}=r,u=i[i.length-1]instanceof s,a=u?i.pop():new s,c=n.initializeContext(this,i,a),l=[(h,p)=>p().then(()=>u?h:h.result)],f=n.collectMiddleware(this,i);return f&&Array.prototype.push.apply(l,f),l.push((h,p)=>Object.prototype.hasOwnProperty.call(c,"result")?p():Promise.resolve(o.apply(this,h.arguments)).then(b=>(h.result=b,p()))),(0,ac.compose)(l).call(this,c)};return(0,kr.copyFnProperties)(r,e),(0,kr.copyProperties)(r,e),(0,Je.setManager)(r,n),Object.assign(r,{original:Yn(e),Context:n.getContextClass(),createContext:(i={})=>new r.Context(i)})}ve.functionHooks=Wn;function uc(e,t){if(Array.isArray(t))return(0,Je.setMiddleware)(e,t);for(const n of Object.keys(t)){const r=typeof e[n]=="function"?e:e.prototype,i=r&&r[n];if(typeof i!="function")throw new Error(`Can not apply hooks. '${n}' is not a function`);const s=(0,Je.convertOptions)(t[n]);r[n]=Wn(i,s.props({method:n}))}return e}ve.objectHooks=uc;const cc=e=>(n,r,i)=>{const s=(0,Je.convertOptions)(e);if(!i)return(0,Je.setManager)(n.prototype,s),n;const o=i.value;if(typeof o!="function")throw new Error(`Can not apply hooks. '${r}' is not a function`);return i.value=Wn(o,s.props({method:r})),i};ve.hookDecorator=cc;var Li={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.collect=e.fromErrorHook=e.fromAfterHook=e.fromBeforeHook=e.runHooks=e.runHook=void 0;const t=nt,n=(a,c,l)=>{const f=c.type;return l&&(c.type=l),Promise.resolve(a.call(c.self,c)).then(h=>{l&&(c.type=f),h&&h!==c&&Object.assign(c,h)})};e.runHook=n;const r=a=>c=>a.reduce((l,f)=>l.then(()=>(0,e.runHook)(f,c)),Promise.resolve(c));e.runHooks=r;function i(a){return(c,l)=>(0,e.runHook)(a,c,"before").then(l)}e.fromBeforeHook=i;function s(a){return(c,l)=>l().then(()=>(0,e.runHook)(a,c,"after"))}e.fromAfterHook=s;function o(a){return(c,l)=>l().catch(f=>((c.error!==f||c.result!==void 0)&&(c.original={...c},c.error=f,delete c.result),(0,e.runHook)(a,c,"error").then(()=>{if(c.result===void 0&&c.error!==void 0)throw c.error}).catch(h=>{throw c.error=h,c.error})))}e.fromErrorHook=o;function u({before:a=[],after:c=[],error:l=[]}){const f=a.map(i),h=[...c].reverse().map(s),p=l.length?[o((0,e.runHooks)(l))]:[];return(0,t.compose)([...p,...f,...h])}e.collect=u})(Li);(function(e){var t=ne&&ne.__createBinding||(Object.create?function(u,a,c,l){l===void 0&&(l=c),Object.defineProperty(u,l,{enumerable:!0,get:function(){return a[c]}})}:function(u,a,c,l){l===void 0&&(l=c),u[l]=a[c]}),n=ne&&ne.__exportStar||function(u,a){for(var c in u)c!=="default"&&!Object.prototype.hasOwnProperty.call(a,c)&&t(a,u,c)};Object.defineProperty(e,"__esModule",{value:!0}),e.hooks=e.middleware=void 0;const r=Jt,i=ve;n(ve,e),n(nt,e),n(Jt,e),n(Li,e);function s(u,a){const c=new r.HookManager().middleware(u);return a&&(a.params&&c.params(...a.params),a.defaults&&c.defaults(a.defaults),a.props&&c.props(a.props)),c}e.middleware=s;function o(...u){const[a,c]=u;return typeof a=="function"&&(c instanceof r.HookManager||Array.isArray(c)||u.length===1)?(0,i.functionHooks)(a,c):u.length===2?(0,i.objectHooks)(a,c):(0,i.hookDecorator)(a)}e.hooks=o})(Xn);var Ze={},St={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.wrapService=e.normalizeServiceOptions=e.getServiceOptions=e.getHookMethods=e.protectedMethods=e.defaultServiceEvents=e.defaultEventMap=e.defaultServiceMethods=e.defaultServiceArguments=e.SERVICE=void 0;const t=Kn,n=xt;e.SERVICE=(0,n.createSymbol)("@feathersjs/service"),e.defaultServiceArguments={find:["params"],get:["id","params"],create:["data","params"],update:["id","data","params"],patch:["id","data","params"],remove:["id","params"]},e.defaultServiceMethods=["find","get","create","update","patch","remove"],e.defaultEventMap={create:"created",update:"updated",patch:"patched",remove:"removed"},e.defaultServiceEvents=Object.values(e.defaultEventMap),e.protectedMethods=Object.keys(Object.prototype).concat(Object.keys(t.EventEmitter.prototype)).concat(["all","around","before","after","error","hooks","setup","teardown","publish"]);function r(u,a){const{methods:c}=a;return e.defaultServiceMethods.filter(l=>typeof u[l]=="function"&&!c.includes(l)).concat(c)}e.getHookMethods=r;function i(u){return u[e.SERVICE]}e.getServiceOptions=i;const s=(u,a={})=>{const{methods:c=e.defaultServiceMethods.filter(h=>typeof u[h]=="function"),events:l=u.events||[]}=a,f=a.serviceEvents||e.defaultServiceEvents.concat(l);return{...a,events:l,methods:c,serviceEvents:f}};e.normalizeServiceOptions=s;function o(u,a,c){if(a[e.SERVICE])return a;const l=Object.create(a),f=(0,e.normalizeServiceOptions)(a,c);if(Object.keys(f.methods).length===0&&![...e.defaultServiceMethods,"setup","teardown"].some(h=>typeof a[h]=="function"))throw new Error(`Invalid service object passed for path \`${u}\``);return Object.defineProperty(l,e.SERVICE,{value:f}),l}e.wrapService=o})(St);Object.defineProperty(Ze,"__esModule",{value:!0});Ze.eventMixin=Ze.eventHook=void 0;const lc=Kn,Ar=St;function fc(e,t){const{events:n}=(0,Ar.getServiceOptions)(e.self),r=Ar.defaultEventMap[e.method]||null;return e.event=r,t().then(()=>{typeof e.event=="string"&&!n.includes(e.event)&&(Array.isArray(e.result)?e.result:[e.result]).forEach(s=>e.self.emit(e.event,s,e))})}Ze.eventHook=fc;function hc(e){return typeof e.on=="function"&&typeof e.emit=="function"||Object.assign(e,lc.EventEmitter.prototype),e}Ze.eventMixin=hc;var re={};Object.defineProperty(re,"__esModule",{value:!0});re.hookMixin=re.FeathersHookManager=re.createContext=re.enableHooks=re.collectHooks=re.convertHookData=void 0;const Fe=Xn,Rr=St,dc=["before","after","error","around"],pc=e=>dc.includes(e);function Pi(e){const t={};if(Array.isArray(e))t.all=e;else if(typeof e!="object")t.all=[e];else for(const n of Object.keys(e)){const r=e[n];t[n]=Array.isArray(r)?r:[r]}return t}re.convertHookData=Pi;function Rn(e,t){const{collected:n,collectedAll:r,around:i}=e.__hooks;return[...i.all||[],...i[t]||[],...r.before||[],...n[t]||[],...r.after||[]]}re.collectHooks=Rn;function Bi(e){return Object.defineProperty(e,"__hooks",{configurable:!0,value:{around:{},before:{},after:{},error:{},collected:{},collectedAll:{}},writable:!0}),function(r){const i=this.__hooks,s=Object.keys(r).reduce((u,a)=>{if(!pc(a))throw new Error(`'${a}' is not a valid hook type`);return u[a]=Pi(r[a]),u},{});return Object.keys(s).forEach(u=>Object.keys(s[u]).forEach(a=>{var c;const l=s[u][a];if(((c=i[u])[a]||(c[a]=[])).push(...l),a==="all"){if(i.before[a]||i.error[a]){const h=(0,Fe.collect)({before:i.before[a]||[],error:i.error[a]||[]});i.collectedAll.before=[h]}if(i.after[a]){const h=(0,Fe.collect)({after:i.after[a]||[]});i.collectedAll.after=[h]}}else if(i.before[a]||i.after[a]||i.error[a]){const h=(0,Fe.collect)({before:i.before[a]||[],after:i.after[a]||[],error:i.error[a]||[]});i.collected[a]=[h]}})),this}}re.enableHooks=Bi;function gc(e,t,n={}){const r=e[t].createContext;if(typeof r!="function")throw new Error(`Can not create context for method ${t}`);return r(n)}re.createContext=gc;class On extends Fe.HookManager{constructor(t,n){super(),this.app=t,this.method=n,this._middleware=[]}collectMiddleware(t,n){const r=Rn(this.app,this.method),i=super.collectMiddleware(t,n),s=Rn(t,this.method);return[...r,...i,...s]}initializeContext(t,n,r){const i=super.initializeContext(t,n,r);return i.params=i.params||{},i}middleware(t){return this._middleware.push(...t),this}}re.FeathersHookManager=On;function vc(e,t,n){if(typeof e.hooks=="function")return e;const i=(0,Rr.getHookMethods)(e,n).reduce((o,u)=>{const a=Rr.defaultServiceArguments[u]||["data","params"];return o[u]=new On(this,u).params(...a).props({app:this,path:t,method:u,service:e,event:null,type:"around",get statusCode(){var c;return(c=this.http)===null||c===void 0?void 0:c.status},set statusCode(c){this.http=this.http||{},this.http.status=c}}),o},{}),s=Bi(e);return(0,Fe.hooks)(e,i),e.hooks=function(o){return o.before||o.after||o.error||o.around?s.call(this,o):Array.isArray(o)?(0,Fe.hooks)(this,o):(Object.keys(o).forEach(u=>{const a=(0,Fe.getManager)(this[u]);if(!(a instanceof On))throw new Error(`Method ${u} is not a Feathers hooks enabled service method`);a.middleware(o[u])}),this)},e}re.hookMixin=vc;var yc=ne&&ne.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(sn,"__esModule",{value:!0});sn.Feathers=void 0;const mc=yc(on),wc=Kn,Ut=xt,Te=Xn,Or=Ze,_c=re,dn=St,bc=re,Nt=(0,Ut.createDebug)("@feathersjs/feathers");class Ec extends wc.EventEmitter{constructor(){super(),this.services={},this.settings={},this.mixins=[_c.hookMixin,Or.eventMixin],this.version=mc.default,this._isSetup=!1,this.registerHooks=(0,bc.enableHooks)(this),this.registerHooks({around:[Or.eventHook]})}get(t){return this.settings[t]}set(t,n){return this.settings[t]=n,this}configure(t){return t.call(this,this),this}defaultService(t){throw new Error(`Can not find service '${t}'`)}service(t){const n=(0,Ut.stripSlashes)(t)||"/",r=this.services.hasOwnProperty(n)?this.services[n]:void 0;return typeof r>"u"?(this.use(n,this.defaultService(n)),this.service(n)):r}_setup(){return this._isSetup=!0,Object.keys(this.services).reduce((t,n)=>t.then(()=>{const r=this.service(n);if(typeof r.setup=="function")return Nt(`Setting up service for \`${n}\``),r.setup(this,n)}),Promise.resolve()).then(()=>this)}get setup(){return this._setup}set setup(t){this._setup=t[Te.HOOKS]?t:(0,Te.hooks)(t,(0,Te.middleware)().params("server").props({app:this}))}_teardown(){return this._isSetup=!1,Object.keys(this.services).reduce((t,n)=>t.then(()=>{const r=this.service(n);if(typeof r.teardown=="function")return Nt(`Tearing down service for \`${n}\``),r.teardown(this,n)}),Promise.resolve()).then(()=>this)}get teardown(){return this._teardown}set teardown(t){this._teardown=t[Te.HOOKS]?t:(0,Te.hooks)(t,(0,Te.middleware)().params("server").props({app:this}))}use(t,n,r){if(typeof t!="string")throw new Error(`'${t}' is not a valid service path.`);const i=(0,Ut.stripSlashes)(t)||"/",s=n;if(typeof s.service=="function"&&s.services)return Object.keys(s.services).forEach(c=>this.use(`${i}/${c}`,s.service(c))),this;const u=(0,dn.wrapService)(i,n,r),a=(0,dn.getServiceOptions)(u);for(const c of dn.protectedMethods)if(a.methods.includes(c))throw new Error(`'${c}' on service '${i}' is not allowed as a custom method name`);return Nt(`Registering new service at \`${i}\``),this.mixins.forEach(c=>c.call(this,u,i,a)),this.services[i]=u,this._isSetup&&typeof u.setup=="function"&&(Nt(`Setting up service for \`${i}\``),u.setup(this,i)),this}async unuse(t){const n=(0,Ut.stripSlashes)(t)||"/",r=this.services[n];return r&&typeof r.teardown=="function"&&await r.teardown(this,n),delete this.services[n],r}hooks(t){const n=t;return n.before||n.after||n.error||n.around?this.registerHooks(n):n.setup||n.teardown?(0,Te.hooks)(this,n):this.registerHooks({around:n}),this}}sn.Feathers=Ec;var Ii={};Object.defineProperty(Ii,"__esModule",{value:!0});(function(e,t){var n=ne&&ne.__createBinding||(Object.create?function(c,l,f,h){h===void 0&&(h=f);var p=Object.getOwnPropertyDescriptor(l,f);(!p||("get"in p?!l.__esModule:p.writable||p.configurable))&&(p={enumerable:!0,get:function(){return l[f]}}),Object.defineProperty(c,h,p)}:function(c,l,f,h){h===void 0&&(h=f),c[h]=l[f]}),r=ne&&ne.__exportStar||function(c,l){for(var f in c)f!=="default"&&!Object.prototype.hasOwnProperty.call(l,f)&&n(l,c,f)},i=ne&&ne.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(t,"__esModule",{value:!0}),t.Feathers=t.version=t.feathers=void 0;const s=xt,o=i(on);t.version=o.default;const u=sn;Object.defineProperty(t,"Feathers",{enumerable:!0,get:function(){return u.Feathers}});function a(){return new u.Feathers}t.feathers=a,a.setDebug=s.setDebug,r(re,t),r(Ii,t),r(St,t),e.exports=Object.assign(a,e.exports)})(An,An.exports);var Hi=An.exports,Mn={exports:{}},un={},$i={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.convert=e.errors=e.Unavailable=e.BadGateway=e.NotImplemented=e.GeneralError=e.TooManyRequests=e.Unprocessable=e.LengthRequired=e.Gone=e.Conflict=e.Timeout=e.NotAcceptable=e.MethodNotAllowed=e.NotFound=e.Forbidden=e.PaymentError=e.NotAuthenticated=e.BadRequest=e.FeathersError=void 0;class t extends Error{constructor(m,x,J,Y,S){let L=typeof m=="string"?m:"Error";const w={name:x,code:J,className:Y,type:"FeathersError"};if(Array.isArray(S))w.data=S;else if(typeof m=="object"||S!==void 0){const{message:U,errors:F,...ee}=m!==null&&typeof m=="object"?m:S;L=U||L,w.errors=F,w.data=ee}super(L),Object.assign(this,w)}toJSON(){const m={name:this.name,message:this.message,code:this.code,className:this.className};return this.data!==void 0&&(m.data=this.data),this.errors!==void 0&&(m.errors=this.errors),m}}e.FeathersError=t;class n extends t{constructor(m,x){super(m,"BadRequest",400,"bad-request",x)}}e.BadRequest=n;class r extends t{constructor(m,x){super(m,"NotAuthenticated",401,"not-authenticated",x)}}e.NotAuthenticated=r;class i extends t{constructor(m,x){super(m,"PaymentError",402,"payment-error",x)}}e.PaymentError=i;class s extends t{constructor(m,x){super(m,"Forbidden",403,"forbidden",x)}}e.Forbidden=s;class o extends t{constructor(m,x){super(m,"NotFound",404,"not-found",x)}}e.NotFound=o;class u extends t{constructor(m,x){super(m,"MethodNotAllowed",405,"method-not-allowed",x)}}e.MethodNotAllowed=u;class a extends t{constructor(m,x){super(m,"NotAcceptable",406,"not-acceptable",x)}}e.NotAcceptable=a;class c extends t{constructor(m,x){super(m,"Timeout",408,"timeout",x)}}e.Timeout=c;class l extends t{constructor(m,x){super(m,"Conflict",409,"conflict",x)}}e.Conflict=l;class f extends t{constructor(m,x){super(m,"Gone",410,"gone",x)}}e.Gone=f;class h extends t{constructor(m,x){super(m,"LengthRequired",411,"length-required",x)}}e.LengthRequired=h;class p extends t{constructor(m,x){super(m,"Unprocessable",422,"unprocessable",x)}}e.Unprocessable=p;class b extends t{constructor(m,x){super(m,"TooManyRequests",429,"too-many-requests",x)}}e.TooManyRequests=b;class C extends t{constructor(m,x){super(m,"GeneralError",500,"general-error",x)}}e.GeneralError=C;class H extends t{constructor(m,x){super(m,"NotImplemented",501,"not-implemented",x)}}e.NotImplemented=H;class T extends t{constructor(m,x){super(m,"BadGateway",502,"bad-gateway",x)}}e.BadGateway=T;class A extends t{constructor(m,x){super(m,"Unavailable",503,"unavailable",x)}}e.Unavailable=A,e.errors={FeathersError:t,BadRequest:n,NotAuthenticated:r,PaymentError:i,Forbidden:s,NotFound:o,MethodNotAllowed:u,NotAcceptable:a,Timeout:c,Conflict:l,LengthRequired:h,Unprocessable:p,TooManyRequests:b,GeneralError:C,NotImplemented:H,BadGateway:T,Unavailable:A,400:n,401:r,402:i,403:s,404:o,405:u,406:a,408:c,409:l,410:f,411:h,422:p,429:b,500:C,501:H,502:T,503:A};function N(O){if(!O)return O;const m=e.errors[O.name],x=m?new m(O.message,O.data):new Error(O.message||O);return typeof O=="object"&&Object.assign(x,O),x}e.convert=N})($i);Object.defineProperty(un,"__esModule",{value:!0});un.Service=void 0;const xc=$i,Sc=xt,Di=(0,Sc.createDebug)("@feathersjs/transport-commons/client"),Cc=["addListener","addEventListener","emit","listenerCount","listeners","on","once","prependListener","prependOnceListener","removeAllListeners","removeEventListener","removeListener"],kc=["eventNames","getMaxListeners","setMaxListeners"],Ac=e=>{kc.forEach(t=>{e[t]=function(...n){if(typeof this.connection[t]!="function")throw new Error(`Can not call '${t}' on the client service connection`);return this.connection[t](...n)}}),Cc.forEach(t=>{e[t]=function(n,...r){if(typeof this.connection[t]!="function")throw new Error(`Can not call '${t}' on the client service connection`);const i=`${this.path} ${n}`;Di(`Calling emitter method ${t} with namespaced event '${i}'`);const s=this.connection[t](i,...r);return s===this.connection?this:s}})};class Rc{constructor(t){this.events=t.events,this.path=t.name,this.connection=t.connection,this.method=t.method,Ac(this)}send(t,...n){return new Promise((r,i)=>{n.unshift(t,this.path),n.push(function(s,o){return s?i((0,xc.convert)(s)):r(o)}),Di(`Sending socket.${this.method}`,n),this.connection[this.method](...n)})}methods(...t){return t.forEach(n=>{this[n]=function(r,i={}){return this.send(n,r,i.query||{})}}),this}find(t={}){return this.send("find",t.query||{})}get(t,n={}){return this.send("get",t,n.query||{})}create(t,n={}){return this.send("create",t,n.query||{})}update(t,n,r={}){return this.send("update",t,n,r.query||{})}patch(t,n,r={}){return this.send("patch",t,n,r.query||{})}remove(t,n={}){return this.send("remove",t,n.query||{})}off(t,...n){if(typeof this.connection.off=="function"){const r=this.connection.off(`${this.path} ${t}`,...n);return r===this.connection?this:r}else if(n.length===0)return this.removeAllListeners(t);return this.removeListener(t,...n)}}un.Service=Rc;var Oc=un;(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const n=Oc,r=Hi;function i(s,o){if(!s)throw new Error("Socket.io connection needs to be provided");const u=function(c){const l=Object.values(r.defaultEventMap),f=Object.assign({},o,{events:l,name:c,connection:s,method:"emit"});return new n.Service(f)},a=function(c){if(c.io!==void 0)throw new Error("Only one default client provider can be configured");c.io=s,c.defaultService=u,c.mixins.unshift((l,f,h)=>{if(h&&h.methods&&l instanceof n.Service){const p=h.methods.filter(b=>!r.defaultServiceMethods.includes(b));l.methods(...p)}})};return a.Service=n.Service,a.service=u,a}t.default=i,e.exports=Object.assign(i,e.exports)})(Mn,Mn.exports);var Mc=Mn.exports;const Nc=No(Mc),Ee=Object.create(null);Ee.open="0";Ee.close="1";Ee.ping="2";Ee.pong="3";Ee.message="4";Ee.upgrade="5";Ee.noop="6";const qt=Object.create(null);Object.keys(Ee).forEach(e=>{qt[Ee[e]]=e});const Nn={type:"error",data:"parser error"},Fi=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Vi=typeof ArrayBuffer=="function",Ui=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,Gn=({type:e,data:t},n,r)=>Fi&&t instanceof Blob?n?r(t):Mr(t,r):Vi&&(t instanceof ArrayBuffer||Ui(t))?n?r(t):Mr(new Blob([t]),r):r(Ee[e]+(t||"")),Mr=(e,t)=>{const n=new FileReader;return n.onload=function(){const r=n.result.split(",")[1];t("b"+(r||""))},n.readAsDataURL(e)};function Nr(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let pn;function Tc(e,t){if(Fi&&e.data instanceof Blob)return e.data.arrayBuffer().then(Nr).then(t);if(Vi&&(e.data instanceof ArrayBuffer||Ui(e.data)))return t(Nr(e.data));Gn(e,!1,n=>{pn||(pn=new TextEncoder),t(pn.encode(n))})}const Tr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",dt=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<Tr.length;e++)dt[Tr.charCodeAt(e)]=e;const Lc=e=>{let t=e.length*.75,n=e.length,r,i=0,s,o,u,a;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const c=new ArrayBuffer(t),l=new Uint8Array(c);for(r=0;r<n;r+=4)s=dt[e.charCodeAt(r)],o=dt[e.charCodeAt(r+1)],u=dt[e.charCodeAt(r+2)],a=dt[e.charCodeAt(r+3)],l[i++]=s<<2|o>>4,l[i++]=(o&15)<<4|u>>2,l[i++]=(u&3)<<6|a&63;return c},Pc=typeof ArrayBuffer=="function",Qn=(e,t)=>{if(typeof e!="string")return{type:"message",data:qi(e,t)};const n=e.charAt(0);return n==="b"?{type:"message",data:Bc(e.substring(1),t)}:qt[n]?e.length>1?{type:qt[n],data:e.substring(1)}:{type:qt[n]}:Nn},Bc=(e,t)=>{if(Pc){const n=Lc(e);return qi(n,t)}else return{base64:!0,data:e}},qi=(e,t)=>{switch(t){case"blob":return e instanceof Blob?e:new Blob([e]);case"arraybuffer":default:return e instanceof ArrayBuffer?e:e.buffer}},ji=String.fromCharCode(30),Ic=(e,t)=>{const n=e.length,r=new Array(n);let i=0;e.forEach((s,o)=>{Gn(s,!1,u=>{r[o]=u,++i===n&&t(r.join(ji))})})},Hc=(e,t)=>{const n=e.split(ji),r=[];for(let i=0;i<n.length;i++){const s=Qn(n[i],t);if(r.push(s),s.type==="error")break}return r};function $c(){return new TransformStream({transform(e,t){Tc(e,n=>{const r=n.length;let i;if(r<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,r);else if(r<65536){i=new Uint8Array(3);const s=new DataView(i.buffer);s.setUint8(0,126),s.setUint16(1,r)}else{i=new Uint8Array(9);const s=new DataView(i.buffer);s.setUint8(0,127),s.setBigUint64(1,BigInt(r))}e.data&&typeof e.data!="string"&&(i[0]|=128),t.enqueue(i),t.enqueue(n)})}})}let gn;function Tt(e){return e.reduce((t,n)=>t+n.length,0)}function Lt(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let r=0;for(let i=0;i<t;i++)n[i]=e[0][r++],r===e[0].length&&(e.shift(),r=0);return e.length&&r<e[0].length&&(e[0]=e[0].slice(r)),n}function Dc(e,t){gn||(gn=new TextDecoder);const n=[];let r=0,i=-1,s=!1;return new TransformStream({transform(o,u){for(n.push(o);;){if(r===0){if(Tt(n)<1)break;const a=Lt(n,1);s=(a[0]&128)===128,i=a[0]&127,i<126?r=3:i===126?r=1:r=2}else if(r===1){if(Tt(n)<2)break;const a=Lt(n,2);i=new DataView(a.buffer,a.byteOffset,a.length).getUint16(0),r=3}else if(r===2){if(Tt(n)<8)break;const a=Lt(n,8),c=new DataView(a.buffer,a.byteOffset,a.length),l=c.getUint32(0);if(l>Math.pow(2,53-32)-1){u.enqueue(Nn);break}i=l*Math.pow(2,32)+c.getUint32(4),r=3}else{if(Tt(n)<i)break;const a=Lt(n,i);u.enqueue(Qn(s?a:gn.decode(a),t)),r=0}if(i===0||i>e){u.enqueue(Nn);break}}}})}const zi=4;function Z(e){if(e)return Fc(e)}function Fc(e){for(var t in Z.prototype)e[t]=Z.prototype[t];return e}Z.prototype.on=Z.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this};Z.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this};Z.prototype.off=Z.prototype.removeListener=Z.prototype.removeAllListeners=Z.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var r,i=0;i<n.length;i++)if(r=n[i],r===t||r.fn===t){n.splice(i,1);break}return n.length===0&&delete this._callbacks["$"+e],this};Z.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,t)}return this};Z.prototype.emitReserved=Z.prototype.emit;Z.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};Z.prototype.hasListeners=function(e){return!!this.listeners(e).length};const le=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function Ki(e,...t){return t.reduce((n,r)=>(e.hasOwnProperty(r)&&(n[r]=e[r]),n),{})}const Vc=le.setTimeout,Uc=le.clearTimeout;function cn(e,t){t.useNativeTimers?(e.setTimeoutFn=Vc.bind(le),e.clearTimeoutFn=Uc.bind(le)):(e.setTimeoutFn=le.setTimeout.bind(le),e.clearTimeoutFn=le.clearTimeout.bind(le))}const qc=1.33;function jc(e){return typeof e=="string"?zc(e):Math.ceil((e.byteLength||e.size)*qc)}function zc(e){let t=0,n=0;for(let r=0,i=e.length;r<i;r++)t=e.charCodeAt(r),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}function Kc(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}function Xc(e){let t={},n=e.split("&");for(let r=0,i=n.length;r<i;r++){let s=n[r].split("=");t[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return t}class Yc extends Error{constructor(t,n,r){super(t),this.description=n,this.context=r,this.type="TransportError"}}class Jn extends Z{constructor(t){super(),this.writable=!1,cn(this,t),this.opts=t,this.query=t.query,this.socket=t.socket}onError(t,n,r){return super.emitReserved("error",new Yc(t,n,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const n=Qn(t,this.socket.binaryType);this.onPacket(n)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,n={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const n=Kc(t);return n.length?"?"+n:""}}const Xi="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Tn=64,Wc={};let Lr=0,Pt=0,Pr;function Br(e){let t="";do t=Xi[e%Tn]+t,e=Math.floor(e/Tn);while(e>0);return t}function Yi(){const e=Br(+new Date);return e!==Pr?(Lr=0,Pr=e):e+"."+Br(Lr++)}for(;Pt<Tn;Pt++)Wc[Xi[Pt]]=Pt;let Wi=!1;try{Wi=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Gc=Wi;function Gi(e){const t=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||Gc))return new XMLHttpRequest}catch{}if(!t)try{return new le[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function Qc(){}const Jc=function(){return new Gi({xdomain:!1}).responseType!=null}();class Zc extends Jn{constructor(t){if(super(t),this.polling=!1,typeof location<"u"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||i!==t.port}const n=t&&t.forceBase64;this.supportsBinary=Jc&&!n,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const n=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||n()})),this.writable||(r++,this.once("drain",function(){--r||n()}))}else n()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const n=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};Hc(t,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,Ic(t,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=Yi()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(t,n)}request(t={}){return Object.assign(t,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new be(this.uri(),t)}doWrite(t,n){const r=this.request({method:"POST",data:t});r.on("success",n),r.on("error",(i,s)=>{this.onError("xhr post error",i,s)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(n,r)=>{this.onError("xhr poll error",n,r)}),this.pollXhr=t}}class be extends Z{constructor(t,n){super(),cn(this,n),this.opts=n,this.method=n.method||"GET",this.uri=t,this.data=n.data!==void 0?n.data:null,this.create()}create(){var t;const n=Ki(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this.opts.xd;const r=this.xhr=new Gi(n);try{r.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let i in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(i)&&r.setRequestHeader(i,this.opts.extraHeaders[i])}}catch{}if(this.method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(t=this.opts.cookieJar)===null||t===void 0||t.addCookies(r),"withCredentials"in r&&(r.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(r.timeout=this.opts.requestTimeout),r.onreadystatechange=()=>{var i;r.readyState===3&&((i=this.opts.cookieJar)===null||i===void 0||i.parseCookies(r)),r.readyState===4&&(r.status===200||r.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof r.status=="number"?r.status:0)},0))},r.send(this.data)}catch(i){this.setTimeoutFn(()=>{this.onError(i)},0);return}typeof document<"u"&&(this.index=be.requestsCount++,be.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=Qc,t)try{this.xhr.abort()}catch{}typeof document<"u"&&delete be.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}be.requestsCount=0;be.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Ir);else if(typeof addEventListener=="function"){const e="onpagehide"in le?"pagehide":"unload";addEventListener(e,Ir,!1)}}function Ir(){for(let e in be.requests)be.requests.hasOwnProperty(e)&&be.requests[e].abort()}const Zn=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,n)=>n(t,0))(),Bt=le.WebSocket||le.MozWebSocket,Hr=!0,el="arraybuffer",$r=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class tl extends Jn{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),n=this.opts.protocols,r=$r?{}:Ki(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=Hr&&!$r?n?new Bt(t,n):new Bt(t):new Bt(t,n,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const r=t[n],i=n===t.length-1;Gn(r,this.supportsBinary,s=>{const o={};try{Hr&&this.ws.send(s)}catch{}i&&Zn(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=Yi()),this.supportsBinary||(n.b64=1),this.createUri(t,n)}check(){return!!Bt}}class nl extends Jn{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(t=>{const n=Dc(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=t.readable.pipeThrough(n).getReader(),i=$c();i.readable.pipeTo(t.writable),this.writer=i.writable.getWriter();const s=()=>{r.read().then(({done:u,value:a})=>{u||(this.onPacket(a),s())}).catch(u=>{})};s();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this.writer.write(o).then(()=>this.onOpen())})}))}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const r=t[n],i=n===t.length-1;this.writer.write(r).then(()=>{i&&Zn(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this.transport)===null||t===void 0||t.close()}}const rl={websocket:tl,webtransport:nl,polling:Zc},il=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ol=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Ln(e){const t=e,n=e.indexOf("["),r=e.indexOf("]");n!=-1&&r!=-1&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));let i=il.exec(e||""),s={},o=14;for(;o--;)s[ol[o]]=i[o]||"";return n!=-1&&r!=-1&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=sl(s,s.path),s.queryKey=al(s,s.query),s}function sl(e,t){const n=/\/{2,9}/g,r=t.replace(n,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&r.splice(0,1),t.slice(-1)=="/"&&r.splice(r.length-1,1),r}function al(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,s){i&&(n[i]=s)}),n}let Qi=class je extends Z{constructor(t,n={}){super(),this.binaryType=el,this.writeBuffer=[],t&&typeof t=="object"&&(n=t,t=null),t?(t=Ln(t),n.hostname=t.host,n.secure=t.protocol==="https"||t.protocol==="wss",n.port=t.port,t.query&&(n.query=t.query)):n.host&&(n.hostname=Ln(n.host).host),cn(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=n.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Xc(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const n=Object.assign({},this.opts.query);n.EIO=zi,n.transport=t,this.id&&(n.sid=this.id);const r=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new rl[t](r)}open(){let t;if(this.opts.rememberUpgrade&&je.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)t="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else t=this.transports[0];this.readyState="opening";try{t=this.createTransport(t)}catch{this.transports.shift(),this.open();return}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",n=>this.onClose("transport close",n))}probe(t){let n=this.createTransport(t),r=!1;je.priorWebsocketSuccess=!1;const i=()=>{r||(n.send([{type:"ping",data:"probe"}]),n.once("packet",f=>{if(!r)if(f.type==="pong"&&f.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;je.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(l(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const h=new Error("probe error");h.transport=n.name,this.emitReserved("upgradeError",h)}}))};function s(){r||(r=!0,l(),n.close(),n=null)}const o=f=>{const h=new Error("probe error: "+f);h.transport=n.name,s(),this.emitReserved("upgradeError",h)};function u(){o("transport closed")}function a(){o("socket closed")}function c(f){n&&f.name!==n.name&&s()}const l=()=>{n.removeListener("open",i),n.removeListener("error",o),n.removeListener("close",u),this.off("close",a),this.off("upgrading",c)};n.once("open",i),n.once("error",o),n.once("close",u),this.once("close",a),this.once("upgrading",c),this.upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{r||n.open()},200):n.open()}onOpen(){if(this.readyState="open",je.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let t=0;const n=this.upgrades.length;for(;t<n;t++)this.probe(this.upgrades[t])}}onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),this.resetPingTimeout(),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const n=new Error("server error");n.code=t.data,this.onError(n);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let r=0;r<this.writeBuffer.length;r++){const i=this.writeBuffer[r].data;if(i&&(n+=jc(i)),r>0&&n>this.maxPayload)return this.writeBuffer.slice(0,r);n+=2}return this.writeBuffer}write(t,n,r){return this.sendPacket("message",t,n,r),this}send(t,n,r){return this.sendPacket("message",t,n,r),this}sendPacket(t,n,r,i){if(typeof n=="function"&&(i=n,n=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const s={type:t,data:n,options:r};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),t()},r=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():t()}):this.upgrading?r():t()),this}onError(t){je.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,n){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,n),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const n=[];let r=0;const i=t.length;for(;r<i;r++)~this.transports.indexOf(t[r])&&n.push(t[r]);return n}};Qi.protocol=zi;function ul(e,t="",n){let r=e;n=n||typeof location<"u"&&location,e==null&&(e=n.protocol+"//"+n.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=n.protocol+e:e=n.host+e),/^(https?|wss?):\/\//.test(e)||(typeof n<"u"?e=n.protocol+"//"+e:e="https://"+e),r=Ln(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const s=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+s+":"+r.port+t,r.href=r.protocol+"://"+s+(n&&n.port===r.port?"":":"+r.port),r}const cl=typeof ArrayBuffer=="function",ll=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,Ji=Object.prototype.toString,fl=typeof Blob=="function"||typeof Blob<"u"&&Ji.call(Blob)==="[object BlobConstructor]",hl=typeof File=="function"||typeof File<"u"&&Ji.call(File)==="[object FileConstructor]";function er(e){return cl&&(e instanceof ArrayBuffer||ll(e))||fl&&e instanceof Blob||hl&&e instanceof File}function jt(e,t){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let n=0,r=e.length;n<r;n++)if(jt(e[n]))return!0;return!1}if(er(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return jt(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&jt(e[n]))return!0;return!1}function dl(e){const t=[],n=e.data,r=e;return r.data=Pn(n,t),r.attachments=t.length,{packet:r,buffers:t}}function Pn(e,t){if(!e)return e;if(er(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}else if(Array.isArray(e)){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=Pn(e[r],t);return n}else if(typeof e=="object"&&!(e instanceof Date)){const n={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=Pn(e[r],t));return n}return e}function pl(e,t){return e.data=Bn(e.data,t),delete e.attachments,e}function Bn(e,t){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=Bn(e[n],t);else if(typeof e=="object")for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=Bn(e[n],t));return e}const gl=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],vl=5;var B;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(B||(B={}));class yl{constructor(t){this.replacer=t}encode(t){return(t.type===B.EVENT||t.type===B.ACK)&&jt(t)?this.encodeAsBinary({type:t.type===B.EVENT?B.BINARY_EVENT:B.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let n=""+t.type;return(t.type===B.BINARY_EVENT||t.type===B.BINARY_ACK)&&(n+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(n+=t.nsp+","),t.id!=null&&(n+=t.id),t.data!=null&&(n+=JSON.stringify(t.data,this.replacer)),n}encodeAsBinary(t){const n=dl(t),r=this.encodeAsString(n.packet),i=n.buffers;return i.unshift(r),i}}function Dr(e){return Object.prototype.toString.call(e)==="[object Object]"}class tr extends Z{constructor(t){super(),this.reviver=t}add(t){let n;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(t);const r=n.type===B.BINARY_EVENT;r||n.type===B.BINARY_ACK?(n.type=r?B.EVENT:B.ACK,this.reconstructor=new ml(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(er(t)||t.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(t),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let n=0;const r={type:Number(t.charAt(0))};if(B[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===B.BINARY_EVENT||r.type===B.BINARY_ACK){const s=n+1;for(;t.charAt(++n)!=="-"&&n!=t.length;);const o=t.substring(s,n);if(o!=Number(o)||t.charAt(n)!=="-")throw new Error("Illegal attachments");r.attachments=Number(o)}if(t.charAt(n+1)==="/"){const s=n+1;for(;++n&&!(t.charAt(n)===","||n===t.length););r.nsp=t.substring(s,n)}else r.nsp="/";const i=t.charAt(n+1);if(i!==""&&Number(i)==i){const s=n+1;for(;++n;){const o=t.charAt(n);if(o==null||Number(o)!=o){--n;break}if(n===t.length)break}r.id=Number(t.substring(s,n+1))}if(t.charAt(++n)){const s=this.tryParse(t.substr(n));if(tr.isPayloadValid(r.type,s))r.data=s;else throw new Error("invalid payload")}return r}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,n){switch(t){case B.CONNECT:return Dr(n);case B.DISCONNECT:return n===void 0;case B.CONNECT_ERROR:return typeof n=="string"||Dr(n);case B.EVENT:case B.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&gl.indexOf(n[0])===-1);case B.ACK:case B.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class ml{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const n=pl(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const wl=Object.freeze(Object.defineProperty({__proto__:null,Decoder:tr,Encoder:yl,get PacketType(){return B},protocol:vl},Symbol.toStringTag,{value:"Module"}));function pe(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const _l=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Zi extends Z{constructor(t,n,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=n,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[pe(t,"open",this.onopen.bind(this)),pe(t,"packet",this.onpacket.bind(this)),pe(t,"error",this.onerror.bind(this)),pe(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...n){if(_l.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(n.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const r={type:B.EVENT,data:n};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const o=this.ids++,u=n.pop();this._registerAckCallback(o,u),r.id=o}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(t,n){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[t]=n;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===t&&this.sendBuffer.splice(o,1);n.call(this,new Error("operation has timed out"))},i);this.acks[t]=(...o)=>{this.io.clearTimeoutFn(s),n.apply(this,[null,...o])}}emitWithAck(t,...n){const r=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,s)=>{n.push((o,u)=>r?o?s(o):i(u):i(o)),this.emit(t,...n)})}_addToQueue(t){let n;typeof t[t.length-1]=="function"&&(n=t.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((i,...s)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(i)):(this._queue.shift(),n&&n(null,...s)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!t||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:B.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,n)}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case B.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case B.EVENT:case B.BINARY_EVENT:this.onevent(t);break;case B.ACK:case B.BINARY_ACK:this.onack(t);break;case B.DISCONNECT:this.ondisconnect();break;case B.CONNECT_ERROR:this.destroy();const r=new Error(t.data.message);r.data=t.data.data,this.emitReserved("connect_error",r);break}}onevent(t){const n=t.data||[];t.id!=null&&n.push(this.ack(t.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const r of n)r.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const n=this;let r=!1;return function(...i){r||(r=!0,n.packet({type:B.ACK,id:t,data:i}))}}onack(t){const n=this.acks[t.id];typeof n=="function"&&(n.apply(this,t.data),delete this.acks[t.id])}onconnect(t,n){this.id=t,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:B.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const n=this._anyListeners;for(let r=0;r<n.length;r++)if(t===n[r])return n.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const n=this._anyOutgoingListeners;for(let r=0;r<n.length;r++)if(t===n[r])return n.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const r of n)r.apply(this,t.data)}}}function rt(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}rt.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=Math.floor(t*10)&1?e+n:e-n}return Math.min(e,this.max)|0};rt.prototype.reset=function(){this.attempts=0};rt.prototype.setMin=function(e){this.ms=e};rt.prototype.setMax=function(e){this.max=e};rt.prototype.setJitter=function(e){this.jitter=e};class In extends Z{constructor(t,n){var r;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(n=t,t=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,cn(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((r=n.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new rt({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=t;const i=n.parser||wl;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var n;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(n=this.backoff)===null||n===void 0||n.setMin(t),this)}randomizationFactor(t){var n;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(n=this.backoff)===null||n===void 0||n.setJitter(t),this)}reconnectionDelayMax(t){var n;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(n=this.backoff)===null||n===void 0||n.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new Qi(this.uri,this.opts);const n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=pe(n,"open",function(){r.onopen(),t&&t()}),s=u=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",u),t?t(u):this.maybeReconnectOnOpen()},o=pe(n,"error",s);if(this._timeout!==!1){const u=this._timeout,a=this.setTimeoutFn(()=>{i(),s(new Error("timeout")),n.close()},u);this.opts.autoUnref&&a.unref(),this.subs.push(()=>{this.clearTimeoutFn(a)})}return this.subs.push(i),this.subs.push(o),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(pe(t,"ping",this.onping.bind(this)),pe(t,"data",this.ondata.bind(this)),pe(t,"error",this.onerror.bind(this)),pe(t,"close",this.onclose.bind(this)),pe(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(n){this.onclose("parse error",n)}}ondecoded(t){Zn(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,n){let r=this.nsps[t];return r?this._autoConnect&&!r.active&&r.connect():(r=new Zi(this,t,n),this.nsps[t]=r),r}_destroy(t){const n=Object.keys(this.nsps);for(const r of n)if(this.nsps[r].active)return;this._close()}_packet(t){const n=this.encoder.encode(t);for(let r=0;r<n.length;r++)this.engine.write(n[r],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,n){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(i=>{i?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",i)):t.onreconnect()}))},n);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const at={};function zt(e,t){typeof e=="object"&&(t=e,e=void 0),t=t||{};const n=ul(e,t.path||"/socket.io"),r=n.source,i=n.id,s=n.path,o=at[i]&&s in at[i].nsps,u=t.forceNew||t["force new connection"]||t.multiplex===!1||o;let a;return u?a=new In(r,t):(at[i]||(at[i]=new In(r,t)),a=at[i]),n.query&&!t.query&&(t.query=n.queryKey),a.socket(n.path,t)}Object.assign(zt,{Manager:In,Socket:Zi,io:zt,connect:zt});function bl(){function e(){const t=zt("/msg"),n=Hi.feathers();return n.configure(Nc(t)),n}return{init:e}}const El=he(),xl=bl();function eo(){const e=xl.init();El.$subscribe((u,a)=>{console.log("a change happened"),console.log(u,a)});function t(u){e.service("activeCell").update(null,{activeCell:u},{})}function n(u){e.service("notationSync").create({notation:u},{})}function r(u){e.service("notationSync").remove(u,{})}function i(u){e.service("notationSync").update(null,{notation:u},{})}function s(u){e.service("heartbeat").update(null,{LessonUUId:u},{})}function o(u,a,c){u&&e.service("authorization").update(null,{LessonUUId:c,UserUUId:u,authorized:!0},{}),a&&e.service("authorization").update(null,{LessonUUId:c,userUUId:a,authorized:!1},{})}return{syncOutgoingUpdateSelectedNotation:i,syncOutgoingActiveCell:t,syncOutgoingAuthUser:o,syncOutgoingHeartBeat:s,syncOutgoingRemoveNotation:r,syncOutgoingSaveNotation:n}}const Sl=rn(),q=Zt(),Re=Ur(),M=he(),Fr=$n(),It=eo();function Ct(){Hn(()=>{M.$subscribe((d,g)=>{console.log("a change happened"),console.log(d,g)})});function e(d,g,y){return d.col==g.col&&d.row==g.row&&d.user.uuid===y}function t(d,g,y){return d.col>=g.fromCol&&d.col<=g.toCol&&d.row>=g.fromRow&&d.row<=g.toRow&&d.user.uuid==y}function n(d,g,y){return d.fromCol<=g.col&&d.toCol>=g.col&&d.row==g.row&&d.user.uuid==y}function r(d,g,y){return(d.fromCol>=g.fromCol&&d.fromCol<=g.toCol||d.toCol>=g.fromCol&&d.toCol<=g.toCol)&&d.row==g.row&&d.user.uuid==y}function i(d,g,y){return(d.fromCol>=g.fromCol&&d.fromCol<=g.toCol||d.toCol>=g.fromCol&&d.toCol<=g.toCol)&&d.row>=g.fromRow&&d.row<=g.toRow&&d.user.uuid==y}function s(d,g,y){return d.fromCol<=g.col&&d.toCol>=g.col&&d.fromRow<=g.row&&d.toRow>=g.row&&d.user.uuid==y}function o(d,g,y){return(d.fromCol>=g.fromCol&&d.fromCol<=g.toCol||d.toCol>=g.fromCol&&d.toCol<=g.toCol)&&(d.fromRow>=g.fromRow&&d.fromRow<=g.toRow||d.toRow>=g.fromRow&&d.toRow<=g.toRow)&&d.user.uuid==y}function u(d){let g=q.getCurrentUser().uuid,y=M.getNotations().value;return Array.from(y.values()).filter(P=>P.notationType=="SYMBOL"||P.notationType=="POWER"||P.notationType=="SIGN"?e(P,d,g):P.notationType=="FRACTION"||P.notationType=="SQRT"?n(P,d,g):P.notationType=="TEXT"?s(P,d,g):!1)}function a(d,g){return Object.entries(d).map(y=>y[1]).filter(y=>y.notationType=="SYMBOL"||y.notationType=="POWER"||y.notationType=="SIGN"?t(y,g,q.getCurrentUser().uuid):y.notationType=="FRACTION"||y.notationType=="SQRT"?i(y,g,q.getCurrentUser().uuid):y.notationType=="TEXT"?o(y,g,q.getCurrentUser().uuid):!1)}function c(d){let g=M.getNotations();return Object.entries(g).map(y=>y[1]).filter(y=>y.notationType===d.notationType).find(y=>{switch(d.notationType){case"SYMBOL":case"SIGN":case"POWER":return e(d,y,q.getCurrentUser().uuid);case"FRACTION":case"SQRT":return r(d,y,q.getCurrentUser().uuid);case"TEXT":case"IMAGE":case"GEO":return o(d,y,q.getCurrentUser().uuid)}})}function l(d){let g=M.getNotations();return Object.entries(g).map(y=>y[1]).find(y=>{switch(d.notationType){case"SYMBOL":case"POWER":return e(d,y,q.getCurrentUser().uuid)??n(d,y,q.getCurrentUser().uuid)??s(d,y,q.getCurrentUser().uuid);case"FRACTION":case"SQRT":return n(d,y,q.getCurrentUser().uuid)??r(d,y,q.getCurrentUser().uuid)??i(d,y,q.getCurrentUser().uuid);case"TEXT":case"IMAGE":case"GEO":return t(d,y,q.getCurrentUser().uuid)??i(d,y,q.getCurrentUser().uuid)??o(d,y,q.getCurrentUser().uuid)}})}async function f(d){let g=u(d).filter(y=>y.notationType==="SYMBOL"||y.notationType==="SIGN");return g?(g.forEach(async y=>{await Re.removeNotation(y).then(()=>M.getNotations().value.delete(y.uuid))}),g):[]}async function h(){if(!Fr.canEdit()||!M.getActiveNotation())return null;const d=M.getActiveNotation().value;await Re.removeNotation(d);let g=d.uuid;if(M.setActiveNotation(null),!g)return null;let y=M.getNotations().value.get(g);return y&&It.syncOutgoingRemoveNotation(y.uuid),y||null}async function p(){Fr.canEdit&&(M.getSelectedNotations().forEach(async d=>{d&&(await Re.removeNotation(d),M.getNotations().value.delete(d.uuid),It.syncOutgoingRemoveNotation(d.uuid))}),this.resetSelectedNotations())}async function b(d){u(d).forEach(g=>{M.selectNotation(g.uuid)})}async function C(d,g){M.getSelectedNotations().forEach(y=>{if(y!=null&&y.notationType)switch(Be.get(y.notationType)){case"POINT":{y.col+=d,y.row+=g;break}case"LINE":{y.fromCol+=d,y.toCol+=d,y.row+=g;break}case"RECT":{y.fromCol+=d,y.toCol+=d,y.fromRow+=g,y.toRow+=g;break}}})}async function H(){M.getSelectedNotations().forEach(d=>{d&&m(d)}),M.getSelectedNotations().forEach(async d=>{d&&(m(d)||(await Re.updateNotationCoordinates(d),It.syncOutgoingUpdateSelectedNotation(d)))}),M.resetSelectedNotations()}async function T(d){O(d)||(await Re.updateLineAttributes(d),M.setNotation(d.uuid,d))}async function A(d){let g=c(d);if(g)return N(g,d),await Re.updateNotationValue(g),M.getNotations().value.set(g.uuid,g),g;if(l(d))return null;let P=await Re.addNotation(d);return M.addNotation({...P,notationType:d.notationType}),P}function N(d,g){switch(Be.get(d.notationType)){case"POINT":{d.col=g.col,d.row=g.row,d.notationType=="SYMBOL";break}case"LINE":{d.fromCol=g.fromCol,d.toCol=g.toCol,d.row=g.row;break}case"RECT":{d.fromCol=g.fromCol,d.toCol=g.toCol,d.fromRow=g.fromRow,d.toRow=g.toRow;break}}}function O(d){var g,y;for(let P=d.fromCol;P<=d.toCol;P++)if(d.boardType==="ANSWER"&&!q.isTeacher()&&((y=(g=M.getCellOccupationMatrix().at(d.row))==null?void 0:g.at(P))==null?void 0:y.boardType)=="QUESTION")return!0;return!1}function m(d){var g,y,P,j;if(!d)return!1;switch(Be.get(d.notationType)){case"POINT":{let z=d;return(d==null?void 0:d.boardType)==="ANSWER"&&!q.isTeacher()&&((y=(g=M.getCellOccupationMatrix().at(z.row))==null?void 0:g.at(z.col))==null?void 0:y.boardType)=="QUESTION"}case"RECT":{let z=d;for(let $=z.fromCol;$<=z.toCol;$++)for(let Se=z.fromRow;$<=z.toRow;Se++)if((d==null?void 0:d.boardType)==="ANSWER"&&!q.isTeacher()&&((j=(P=M.getCellOccupationMatrix().at(Se))==null?void 0:P.at($))==null?void 0:j.boardType)=="QUESTION")return!0}}return!1}async function x(d){let g=a(M.getNotations().value,d);g&&g.forEach(async y=>{y.boardType=M.getParent().value.type,await Re.removeNotation(y).then(()=>M.getNotations().value.delete(y.uuid))})}function J(d){var g,y;return M.getParent().value.type=="ANSWER"&&!q.isTeacher()&&d&&((y=(g=M.getCellOccupationMatrix().at(d.row))==null?void 0:g.at(d.col))==null?void 0:y.boardType)=="QUESTION"}function Y(){if(M.getEditMode().value=="CHECKMARK"){F("&#x2714");return}if(M.getEditMode().value=="SEMICHECKMARK"){F("&#x237B");return}if(M.getEditMode().value=="XMARK"){F("&#x2718");return}}function S(){M.getActiveCell()&&L(),M.getActiveNotation()&&h(),M.getActiveNotation()&&p()}async function L(){if(!M.getActiveCell().value)return;let d=await f(M.getActiveCell().value);d&&d.forEach(g=>{It.syncOutgoingRemoveNotation(g.uuid)})}function w(d,g,y,P,j){let z={fromCol:d,toCol:g,fromRow:y,toRow:P,value:j,boardType:M.getParent().value.type,parentUUId:M.getParent().value.uuid,notationType:"IMAGE",user:q.getCurrentUser()};A(z),M.resetActiveCell()}function U(d,g,y,P,j){let z={fromCol:d,toCol:g,fromRow:y,toRow:P,value:j,boardType:M.getParent().value.type,parentUUId:M.getParent().value.uuid,notationType:"TEXT",user:q.getCurrentUser()};A(z)}function F(d){if(!M.getActiveCell().value)return;let g={col:M.getActiveCell().value.col,row:M.getActiveCell().value.row,value:d,boardType:M.getParent().value.type,parentUUId:M.getParent().value.uuid,notationType:"SYMBOL",user:q.getCurrentUser()};A(g),M.getEditMode().value=="SYMBOL"&&Sl.setNextRect(1,0)}function ee(d,g){let y={fromCol:d.fromCol,toCol:d.toCol,row:d.row,boardType:M.getParent().value.type,parentUUId:M.getParent().value.uuid,notationType:g,user:q.getCurrentUser()};A(y)}return{selectNotation:b,isNotationInQuestionArea:m,isCellInQuestionArea:J,removeNotationsByRect:x,addSymbolNotation:F,addMarkNotation:Y,addImageNotation:w,addTextNotation:U,addLineNotation:ee,removeActiveOrSelectedNotations:S,moveSelectedNotations:C,updateSelectedNotationCoordinates:H,updateLineNotation:T}}const Vr=et(),de=he(),Cl=Ct(),se=Wu();function kl(){function e(l){de.isLineMode()||o(l)||u(l)||a(l)||c(l)}async function t(l){Cl.isNotationInQuestionArea(l)||de.setActiveNotation(l)}function n(){de.setActiveCell(null),t(null)}function r(l){let f=se.findRectAtClickedPosition(l);return f?de.getNotationsByShape("RECT").find(h=>{se.getElementAttributeValue(f,"fromCol")>=h.fromCol&&se.getElementAttributeValue(f,"toCol")<=h.toCol&&se.getElementAttributeValue(f,"fromRow")>=h.fromRow&&se.getElementAttributeValue(f,"toRow")>=h.toRow}):null}function i(l,f,h){var p,b;if((f==null?void 0:f.col)!=null){let C=(p=document==null?void 0:document.querySelector(`svg[id="${l}"] g[row="${f.row}"]`))==null?void 0:p.querySelector(`rect[col="${f.col}"]`);C!=null&&C.style&&(C.style.fill="")}if((h==null?void 0:h.col)!=null){let C=(b=document==null?void 0:document.querySelector(`svg[id="${l}"] g[row="${h.row}"]`))==null?void 0:b.querySelector(`rect[col="${h.col}"]`);C!=null&&C.style&&(C.style.fill=no)}}function s(l){return de.getNotationsByShape("LINE").find(h=>se.getElementAttributeValue(l,"fromCol")>=h.fromCol&&se.getElementAttributeValue(l,"toCol")<=h.toCol&&se.getElementAttributeValue(l,"row")==h.row)}function o(l){let f=r(l);return f?(t(f).then(()=>{const h=ro.get(f.notationType);h&&de.setEditMode(h)}),!0):!1}function u(l){const f=se.findClickedObject({x:l.clientX,y:l.clientY},"foreignObject",["FRACTION"]);if(de.setEditMode("FRACTION_SELECTING"),f){const h=s(f);if(h)return Vr.emit("lineSelected",h),!0}return!1}function a(l){const f=se.findClickedObject({x:l.clientX,y:l.clientY},"foreignObject",["SQRT"]);if(de.setEditMode("SQRT_SELECTING"),f){const h=s(f);if(h)return Vr.emit("lineSelected",h),!0}return!1}function c(l){let f=se.findClickedObject(l,"rect",null);if(!(f!=null&&f.parentElement))return null;let h={col:se.getElementAttributeValue(f,"col"),row:se.getElementAttributeValue(f.parentElement,"row")};de.setActiveCell(h),de.resetEditMode(),de.getParent().value.type=="LESSON"}return{activateCell:i,activateClickedObject:e,reset:n}}const Al=Zt(),qe=he(),Oe=rn(),ut=Ct(),Rl=$n(),Le=et();function Ol(){Q(()=>Le.bus.value.get("keyup"),A=>{t(A)}),Q(()=>Le.bus.value.get("paste"),A=>{e(A)});async function e(A){if(!Al.isTeacher)return;const N=A.clipboardData,O=N==null?void 0:N.items[0];var m=new FileReader,x=this;m.addEventListener("load",()=>{const J=m.result;let Y=new Image;Y.src=J,Y.onload=()=>{if(!J)return;let S=parseInt(x.getActiveCell().col),L=parseInt(x.getActiveCell().row),w=Math.ceil(Y.width/Oe.getRectSize())+S,U=Math.ceil(Y.height/Oe.getRectSize())+L;ut.addImageNotation(S,w,L,U,J.toString())}}),m.readAsDataURL(O==null?void 0:O.getAsFile())}function t(A){const{ctrlKey:N,altKey:O,code:m,key:x}=A;if(!(N||O)&&(m.startsWith("Digit")||m.startsWith("Key")||m.startsWith("Numpad")||m==="Minus"||m==="Delete"||m==="Backspace"||m==="Plus"||m==="Equal"||m==="Period"||m==="ArrowLeft"||m==="ArrowRight"||m==="ArrowUp"||m==="ArrowDown"||m==="Space")){if(m==="Backspace"){ut.removeActiveOrSelectedNotations(),Oe.setNextRect(-1,0);return}if(m==="Delete"){ut.removeActiveOrSelectedNotations();return}if(m==="ArrowLeft"){Oe.setNextRect(-1,0);return}if(m==="ArrowRight"||m==="Space"){Oe.setNextRect(1,0);return}if(m==="ArrowUp"){Oe.setNextRect(0,-1);return}if(m==="ArrowDown"){Oe.setNextRect(0,1);return}if(m==="Enter"){Oe.setNextRect(0,-1);return}Rl.canEdit&&ut.addSymbolNotation(x)}}function n(A){if(!(qe.getEditMode().value==="FRACTION"||qe.getEditMode().value==="SQRT"||qe.getEditMode().value==="SELECT")&&(qe.getEditMode().value==="CHECKMARK"||qe.getEditMode().value==="SEMICHECKMARK"||qe.getEditMode().value==="XMARK")){ut.addMarkNotation();return}}function r(A){Le.emit("svgmousedown",A)}function i(A){var N;(N=document==null?void 0:document.getElementById(A))==null||N.addEventListener("mousedown",r)}function s(A){var N;(N=document==null?void 0:document.getElementById(A))==null||N.removeEventListener("mousedown",r)}function o(A){Le.emit("svgmousemove",A)}function u(A){var N;(N=document==null?void 0:document.getElementById(A))==null||N.addEventListener("mousemove",o)}function a(A){var N;(N=document==null?void 0:document.getElementById(A))==null||N.removeEventListener("mousemove",o)}function c(A){Le.emit("svgmouseup",A)}function l(A){var N;(N=document==null?void 0:document.getElementById(A))==null||N.addEventListener("mouseup",c)}function f(A){var N;(N=document==null?void 0:document.getElementById(A))==null||N.removeEventListener("mouseup",c)}function h(A){Le.emit("keyup",A)}function p(){window.addEventListener("keyup",h)}function b(){window.removeEventListener("keyup",h)}function C(A){Le.emit("paste",A)}function H(){document.addEventListener("paste",C)}function T(){document.removeEventListener("paste",C)}return{paste:e,keyUp:t,mouseDown:n,registerSvgMouseDown:i,unregisterSvgMouseDown:s,registerSvgMouseMove:u,unregisterSvgMouseMove:a,registerSvgMouseUp:l,unregisterSvgMouseUp:f,registerKeyUp:p,unregisterKeyUp:b,registerPaste:H,unregisterPaste:T}}const Ml=zr("span",{class:"headline"},"Lesson Access Link",-1),Nl=tt({__name:"AccessLinkDialog",props:{dialog:Boolean},setup(e){const t=e,n=To();Q(()=>t.dialog,o=>{});let r=W(!1);const i=G(()=>"/api/lesson/"+n.getCurrentLesson().uuid);function s(){navigator.clipboard.writeText(i.value),r.value=!1}return(o,u)=>(fe(),He($e,{justify:"center"},{default:k(()=>[_(Gr,{modelValue:X(r),"onUpdate:modelValue":u[2]||(u[2]=a=>we(r)?r.value=a:r=a),"max-width":"400px",onKeydown:u[3]||(u[3]=jr(a=>we(r)?r.value=!1:r=!1,["esc"]))},{default:k(()=>[_(Xe,null,{default:k(()=>[_(Xr,null,{default:k(()=>[Ml]),_:1}),_(Yr,null,{default:k(()=>[_(Kr,null,{default:k(()=>[_($e,null,{default:k(()=>[_(ze,{cols:"12"},{default:k(()=>[_(io,{modelValue:i.value,"onUpdate:modelValue":u[0]||(u[0]=a=>i.value=a),label:"Access Link",value:"",readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),_(Wr,null,{default:k(()=>[_(qr),_(ae,{color:"blue darken-1",onClick:u[1]||(u[1]=a=>we(r)?r.value=!1:r=!1)},{default:k(()=>[ie(" Close ")]),_:1}),_(ae,{color:"blue darken-1",onClick:s},{default:k(()=>[ie(" Copy To Clipboard ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});const Tl=oo({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...so(),...ao()},"VTextarea"),Ll=uo()({name:"VTextarea",directives:{Intersect:co},inheritAttrs:!1,props:Tl(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,t){let{attrs:n,emit:r,slots:i}=t;const s=lo(e,"modelValue"),{isFocused:o,focus:u,blur:a}=fo(e),c=G(()=>typeof e.counterValue=="function"?e.counterValue(s.value):(s.value||"").toString().length),l=G(()=>{if(n.maxlength)return n.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function f(w,U){var F,ee;!e.autofocus||!w||(ee=(F=U[0].target)==null?void 0:F.focus)==null||ee.call(F)}const h=W(),p=W(),b=ho(""),C=W(),H=G(()=>e.persistentPlaceholder||o.value||e.active);function T(){var w;C.value!==document.activeElement&&((w=C.value)==null||w.focus()),o.value||u()}function A(w){T(),r("click:control",w)}function N(w){r("mousedown:control",w)}function O(w){w.stopPropagation(),T(),ln(()=>{s.value="",So(e["onClick:clear"],w)})}function m(w){var F;const U=w.target;if(s.value=U.value,(F=e.modelModifiers)!=null&&F.trim){const ee=[U.selectionStart,U.selectionEnd];ln(()=>{U.selectionStart=ee[0],U.selectionEnd=ee[1]})}}const x=W(),J=W(+e.rows),Y=G(()=>["plain","underlined"].includes(e.variant));po(()=>{e.autoGrow||(J.value=+e.rows)});function S(){e.autoGrow&&ln(()=>{if(!x.value||!p.value)return;const w=getComputedStyle(x.value),U=getComputedStyle(p.value.$el),F=parseFloat(w.getPropertyValue("--v-field-padding-top"))+parseFloat(w.getPropertyValue("--v-input-padding-top"))+parseFloat(w.getPropertyValue("--v-field-padding-bottom")),ee=x.value.scrollHeight,d=parseFloat(w.lineHeight),g=Math.max(parseFloat(e.rows)*d+F,parseFloat(U.getPropertyValue("--v-input-control-height"))),y=parseFloat(e.maxRows)*d+F||1/0,P=ko(ee??0,g,y);J.value=Math.floor((P-F)/d),b.value=Co(P)})}Hn(S),Q(s,S),Q(()=>e.rows,S),Q(()=>e.maxRows,S),Q(()=>e.density,S);let L;return Q(x,w=>{w?(L=new ResizeObserver(S),L.observe(x.value)):L==null||L.disconnect()}),go(()=>{L==null||L.disconnect()}),vo(()=>{const w=!!(i.counter||e.counter||e.counterValue),U=!!(w||i.details),[F,ee]=yo(n),[{modelValue:d,...g}]=or.filterProps(e),[y]=mo(e);return _(or,ce({ref:h,modelValue:s.value,"onUpdate:modelValue":P=>s.value=P,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-text-field--plain-underlined":Y.value},e.class],style:e.style},F,g,{centerAffix:J.value===1&&!Y.value,focused:o.value}),{...i,default:P=>{let{isDisabled:j,isDirty:z,isReadonly:$,isValid:Se}=P;return _(wo,ce({ref:p,style:{"--v-textarea-control-height":b.value},onClick:A,onMousedown:N,"onClick:clear":O,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},y,{active:H.value||z.value,centerAffix:J.value===1&&!Y.value,dirty:z.value||e.dirty,disabled:j.value,focused:o.value,error:Se.value===!1}),{...i,default:kt=>{let{props:{class:it,...At}}=kt;return _(pt,null,[e.prefix&&_("span",{class:"v-text-field__prefix"},[e.prefix]),wn(_("textarea",ce({ref:C,class:it,value:s.value,onInput:m,autofocus:e.autofocus,readonly:$.value,disabled:j.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:T,onBlur:a},At,ee),null),[[_o("intersect"),{handler:f},null,{once:!0}]]),e.autoGrow&&wn(_("textarea",{class:[it,"v-textarea__sizer"],id:`${At.id}-sizer`,"onUpdate:modelValue":v=>s.value=v,ref:x,readonly:!0,"aria-hidden":"true"},null),[[bo,s.value]]),e.suffix&&_("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:U?P=>{var j;return _(pt,null,[(j=i.details)==null?void 0:j.call(i,P),w&&_(pt,null,[_("span",null,null),_(Eo,{active:e.persistentCounter||o.value,value:c.value,max:l.value},i.counter)])])}:void 0})}),xo({},h,p,C)}}),Pl=zr("span",{class:"headline"},"Compose free text",-1),Bl=tt({__name:"FreeTextDialog",props:{show:{type:Boolean}},setup(e){const t=e,n=he(),r=et();let i=W(!1),s=W("");Q(()=>t.show,a=>{i.value=a,o()});function o(){var a;((a=n.activeNotation)==null?void 0:a.notationType)=="TEXT"&&n.activeNotation.value&&(s.value=n.activeNotation.value)}function u(){i.value=!1,s.value="",r.emit("textAdded",s.value)}return(a,c)=>(fe(),He($e,{justify:"center"},{default:k(()=>[_(Gr,{modelValue:X(i),"onUpdate:modelValue":c[2]||(c[2]=l=>we(i)?i.value=l:i=l),"max-width":"800px",onKeydown:c[3]||(c[3]=jr(l=>we(i)?i.value=!1:i=!1,["esc"]))},{default:k(()=>[_(Xe,null,{default:k(()=>[_(Xr,null,{default:k(()=>[Pl]),_:1}),_(Yr,null,{default:k(()=>[_(Kr,null,{default:k(()=>[_($e,null,{default:k(()=>[_(ze,{cols:"12"},{default:k(()=>[_(Ll,{autofocus:"",modelValue:X(s),"onUpdate:modelValue":c[0]||(c[0]=l=>we(s)?s.value=l:s=l),"background-color":"grey lighten-2",color:"cyan"},null,8,["modelValue"])]),_:1})]),_:1}),_($e,null,{default:k(()=>[_(ze,{cols:"6"},{default:k(()=>[ie(" Background color: ")]),_:1})]),_:1})]),_:1})]),_:1}),_(Wr,null,{default:k(()=>[_(qr),_(ae,{color:"blue darken-1",onClick:c[1]||(c[1]=l=>we(i)?i.value=!1:i=!1)},{default:k(()=>[ie(" Close ")]),_:1}),_(ae,{color:"blue darken-1",onClick:u},{default:k(()=>[ie(" Submit text ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),Il=tt({__name:"Toolbar",setup(e){const t=$n();Ct();const n=he(),r=Zt();let i=W(1),s=W(1),o=W(1),u=W(1),a=W(1),c=W(1),l=W(1),f=W(!1),h=W(!1),p=W(1);const b=G(()=>t.canEdit),C=G(()=>{var j;return(j=n.activeNotation)==null?void 0:j.user}),H=G(()=>n.getParent().value.type=="ANSWER"&&r.isTeacher);Q(()=>n.getEditMode(),j=>{j.value===n.getDefaultEditMode()&&T(),j.value==="FRACTION"&&(a.value=0),j.value==="SQRT"&&(c.value=0),j.value===n.getDefaultEditMode()&&T()},{immediate:!0,deep:!0});function T(){i.value=1,s.value=1,o.value=1,u.value=1,a.value=1,c.value=1,l.value=1}function A(){T(),n.getEditMode().value=="FRACTION"?T():N()}function N(){T(),a.value=0,n.setEditMode("FRACTION")}function O(){T(),n.getEditMode().value=="SQRT"?T():m()}function m(){T(),c.value=0,n.setEditMode("SQRT")}function x(){T(),n.getEditMode().value=="POWER"?Y():J()}function J(){T(),l.value=0,n.setEditMode("POWER")}function Y(){T()}function S(){T(),p.value=0,n.setEditMode("TEXT")}function L(){n.getEditMode().value=="SELECT"?U():w()}function w(){T(),u.value=0,n.setEditMode("SELECT")}function U(){T(),n.setEditMode("SYMBOL")}function F(){n.getEditMode().value=="CHECKMARK"?(T(),n.setEditMode("SYMBOL")):ee()}function ee(){T(),i.value=0,n.setEditMode("CHECKMARK")}function d(){n.getEditMode().value=="SEMICHECKMARK"?(T(),n.setEditMode("SYMBOL")):g()}function g(){T(),s.value=0,n.setEditMode("SEMICHECKMARK")}function y(){n.getEditMode().value=="XMARK"?(T(),n.setEditMode("SYMBOL")):P()}function P(){T(),o.value=0,n.setEditMode("XMARK")}return(j,z)=>(fe(),vt(pt,null,[_(Nl,{dialog:X(f)},null,8,["dialog"]),_(Bl,{modelValue:X(h),"onUpdate:modelValue":z[0]||(z[0]=$=>we(h)?h.value=$:h=$)},null,8,["modelValue"]),_(Ao,{color:"primary",dark:"",class:"vertical-toolbar",height:"500"},{default:k(()=>[_(Ce,{text:"<span>Create Access Link</span>"},{activator:k(({props:$})=>[_(ae,ce($,{icon:"",onClick:z[1]||(z[1]=sr(Se=>we(f)?f.value=!0:f=!0,["stop"])),color:"white","x-small":"",fab:"",dark:""}),{default:k(()=>[_(me,null,{default:k(()=>[ie("mdi-account-plus")]),_:1})]),_:2},1040)]),_:1}),_(Ce,{text:"Free Text"},{activator:k(({props:$})=>[_(ae,ce($,{icon:"",disabled:!b.value||!C.value,onClick:[S,z[2]||(z[2]=sr(Se=>we(h)?h.value=!0:h=!0,["stop"]))]}),{default:k(()=>[_(me,null,{default:k(()=>[ie("mdi-text")]),_:1})]),_:2},1040,["disabled"])]),_:1}),_(Ce,{text:"Selection"},{activator:k(({props:$})=>[_(ae,ce($,{color:X(u)?"white":"yellow",icon:"",disabled:!b.value,onClick:L,"x-small":""}),{default:k(()=>[_(me,null,{default:k(()=>[ie("mdi-selection")]),_:1})]),_:2},1040,["color","disabled"])]),_:1}),_(Ce,{text:"Draw fraction line"},{activator:k(({props:$})=>[_(ae,ce($,{icon:"",color:X(a)?"white":"yellow","x-small":"",fab:"",dark:"",onClick:A,disabled:!b.value}),{default:k(()=>[_(me,null,{default:k(()=>[ie("mdi-tooltip-minus-outline")]),_:1})]),_:2},1040,["color","disabled"])]),_:1}),_(Ce,{text:"Draw sqrt line"},{activator:k(({props:$})=>[_(ae,ce($,{icon:"",color:X(c)?"white":"yellow","x-small":"",fab:"",dark:"",onClick:O,disabled:!b.value}),{default:k(()=>[_(me,null,{default:k(()=>[ie("mdi-square-root")]),_:1})]),_:2},1040,["color","disabled"])]),_:1}),_(Ce,{text:"power"},{activator:k(({props:$})=>[_(ae,ce($,{icon:"",color:X(l)?"white":"yellow","x-small":"",fab:"",dark:"",onClick:x,disabled:!b.value}),{default:k(()=>[_(me,null,{default:k(()=>[ie("mdi-exponent")]),_:1})]),_:2},1040,["color","disabled"])]),_:1}),_(Ce,{text:"Correct"},{activator:k(({props:$})=>[H.value?(fe(),He(ae,ce({key:0},$,{icon:"",color:X(i)?"white":"yellow","x-small":"",fab:"",dark:"",onClick:F}),{default:k(()=>[_(me,null,{default:k(()=>[ie("mdi-checkbox-marked-circle-outline")]),_:1})]),_:2},1040,["color"])):Ke("",!0)]),_:1}),_(Ce,{text:"Half Correct"},{activator:k(({props:$})=>[H.value?(fe(),He(ae,ce({key:0},$,{icon:"",color:X(s)?"white":"yellow","x-small":"",fab:"",dark:"",onClick:d}),{default:k(()=>[_(me,{style:{position:"relative",left:"8px"}},{default:k(()=>[ie("mdi-check")]),_:1}),_(me,{style:{position:"relative",left:"-8px",top:"-1px"}},{default:k(()=>[ie("mdi-minus")]),_:1})]),_:2},1040,["color"])):Ke("",!0)]),_:1}),_(Ce,{text:"Incorrect"},{activator:k(({props:$})=>[H.value?(fe(),He(ae,ce({key:0},$,{icon:"",color:X(o)?"white":"yellow","x-small":"",fab:"",dark:"",onClick:y}),{default:k(()=>[_(me,null,{default:k(()=>[ie("mdi-close-outline")]),_:1})]),_:2},1040,["color"])):Ke("",!0)]),_:1})]),_:1})],64))}});const Hl=tt({__name:"AreaSelector",props:{svgId:{type:String,default:""}},setup(e){const t=e,n=et(),r=he(),i=rn(),s=Ct(),o=eo();let u="SELECTING",a=W({x1:0,y1:0,x2:0,y2:0}),c=W({x:0,y:0});const l=G(()=>a.value.x1!=a.value.x2&&a.value.y1!=a.value.y2),f=G(()=>{var S;return(S=document.getElementById(t.svgId))==null?void 0:S.getBoundingClientRect()}),h=G(()=>Math.min(a.value.x1,a.value.x2)),p=G(()=>Math.min(a.value.y1,a.value.y2)),b=G(()=>Math.max(a.value.x1,a.value.x2)-Math.min(a.value.x1,a.value.x2)),C=G(()=>Math.max(a.value.y1,a.value.y2)-Math.min(a.value.y1,a.value.y2));Q(()=>n.bus.value.get("keyup"),S=>{T(S)}),Q(()=>n.bus.value.get("svgmousemove"),S=>{A(S)}),Q(()=>n.bus.value.get("svgmouseup"),S=>{N()});function H(S){n.emit("svgmouseup",S)}function T(S){(S.code==="Backspace"||S.code==="Delete")&&Y()}function A(S){if(r.getEditMode().value==="SELECT"&&S.buttons===1&&r.getEditMode().value=="SELECT"){if(u=="SELECTING"){O(S);return}if(u==="MOVE"){x(S);return}}}function N(S){r.getEditMode().value==="SELECT"&&(u==="SELECTING"?m():u==="MOVE"&&J())}function O(S){a.value.x1==0&&(a.value.x1=S.clientX,a.value.y1=S.clientY),a.value.x2=S.clientX,a.value.y2=S.clientY}function m(){r.resetEditMode(),u="MOVE",a.value.x2!=a.value.x1&&$t("#"+t.svgId).selectAll("foreignObject").each(S=>{let L=S.row??S.fromRow,w=S.col??S.fromCol;i.getRectSize()*w+f.value.x>=a.value.x1&&i.getRectSize()*w+f.value.x<=a.value.x2&&i.getRectSize()*L+f.value.y>=a.value.y1&&i.getRectSize()*L+f.value.y<=a.value.y2&&s.selectNotation({col:w,row:L})})}function x(S){if(!c.value.x){c.value.x=S.clientX-f.value.left,c.value.y=S.clientY-f.value.top;return}if(Math.abs(S.clientX-f.value.x-c.value.x)<i.getRectSize()&&Math.abs(S.clientY-f.value.y-c.value.y)<i.getRectSize())return;const L=Math.round((S.clientX-f.value.x-c.value.x)/i.getRectSize()),w=Math.round((S.clientY-f.value.y-c.value.y)/i.getRectSize());(L!=0||w!=0)&&(s.moveSelectedNotations(L,w),a.value.x1+=L*i.getRectSize(),a.value.y1+=w*i.getRectSize(),a.value.x2+=L*i.getRectSize(),a.value.y2+=w*i.getRectSize(),c.value.x=S.clientX-f.value.x,c.value.y=S.clientY-f.value.y)}function J(S){s.updateSelectedNotationCoordinates(),r.getSelectedNotations().forEach(L=>{L&&o.syncOutgoingUpdateSelectedNotation(L)}),Y()}function Y(){c.value.x=c.value.y=a.value.x1=a.value.x2=a.value.y1=a.value.y2=0,u="SELECTING",r.resetEditMode()}return(S,L)=>l.value?(fe(),He(Xe,{key:0,variant:"outlined",id:"selection",class:"selection",style:ct({left:h.value+"px",top:p.value+"px",width:b.value+"px",height:C.value+"px"}),onMouseup:H},null,8,["style"])):Ke("",!0)}});const Pe=he();function $l(){function e(){switch(Pe.getEditMode().value){case"FRACTION":return Pe.setEditMode("FRACTION_DRAWING");case"SQRT":return Pe.setEditMode("SQRT_DRAWING");case"FRACTION_SELECTED":return Pe.setEditMode("FRACTION_DRAWING");case"SQRT_SELECTED":return Pe.setEditMode("SQRT_DRAWING");case"FRACTION_SELECTING":return Pe.setEditMode("FRACTION_SELECTED");case"SQRT_SELECTING":return Pe.setEditMode("SQRT_SELECTED")}}return{setNextEditMode:e}}const Dl=tt({__name:"LineDrawer",props:{svgId:{type:String,default:""}},setup(e){const t=e,n=et(),r=Ct(),i=he(),s=$l();let o=W({});const u=G(()=>i.isFractionMode()),a=G(()=>i.isSqrtEditMode()),c=G(()=>i.isLineDrawingMode()||i.isLineEditingMode()||i.isLineSelectedMode()||i.isLineSelectingMode()),l=G(()=>{var w;return(w=document.getElementById(t.svgId))==null?void 0:w.getBoundingClientRect()});let f=G(()=>Math.min(o.value.x1,o.value.x2)),h=G(()=>Math.max(o.value.x1,o.value.x2)),p=G(()=>o.value.y);Q(()=>n.bus.value.get("svgmouseup"),()=>{N()}),Q(()=>n.bus.value.get("svgmousemove"),w=>{A(w)}),Q(()=>n.bus.value.get("svgmousedown"),w=>{T(w)}),Q(()=>n.bus.value.get("lineSelected"),w=>{w&&C(w)},{immediate:!0});function b(w){n.emit("svgmouseup",w)}function C(w){m(w)}function H(w){s.setNextEditMode()}function T(w){w.buttons===1&&((i.isLineDrawingMode()||i.isLineEditingMode())&&S(),i.isLineMode()&&O({x:w.offsetX,y:w.offsetY}))}function A(w){w.buttons===1&&(o.value.x1===0&&o.value.x2===0||!i.isLineDrawingMode()&&!i.isLineEditingMode()||x(w.offsetX))}function N(){o.value.x1===0&&o.value.x2===0||!i.isLineDrawingMode()&&!i.isLineEditingMode()||J()}function O(w){s.setNextEditMode(),o.value.x2=o.value.x1=w.x+l.value.left,o.value.y=L(w.y)+l.value.top}function m(w){s.setNextEditMode(),o.value.x1=l.value.left+w.fromCol*i.getRectSize(),o.value.x2=l.value.left+w.toCol*i.getRectSize(),o.value.y=l.value.top+w.row*i.getRectSize(),i.setActiveNotation(w),n.emit("lineSelected",null)}function x(w){w+=l.value.left,w<o.value.x1&&(o.value.x1=w),w>o.value.x1&&(o.value.x2=w)}function J(){if(o.value.x2==o.value.x1)return;let w=Math.ceil((o.value.x1-l.value.left)/i.getRectSize()),U=Math.ceil((o.value.x2-l.value.left)/i.getRectSize()-1),F=Math.round((o.value.y-l.value.top)/i.getRectSize());Y({fromCol:w,toCol:U,row:F}),i.resetEditMode()}function Y(w){r.addLineNotation(w,i.isFractionMode()?"FRACTION":"SQRT")}function S(){o.value.x1=o.value.x2=o.value.y=0,i.setEditMode(i.getDefaultEditMode())}function L(w){return Math.round(w/i.getRectSize())*i.getRectSize()}return(w,U)=>wn((fe(),vt("div",null,[u.value?(fe(),He(Xe,{key:0,id:"lineLeftHandle",class:"lineHandle",style:ct({left:X(f)-5+"px",top:X(p)+"px"}),onMouseup:b,onMousedown:H},null,8,["style"])):Ke("",!0),_(Xe,{id:"lineRightHandle",class:"lineHandle",style:ct({left:X(h)+"px",top:X(p)+"px"}),onMouseup:b,onMousedown:H},null,8,["style"]),_(Xe,{id:"line",class:"line",style:ct({color:"black",left:X(f)+8+"px",top:X(p)+"px",width:X(h)-X(f)+"px",height:"1px"}),onMouseup:b},null,8,["style"]),a.value?(fe(),vt("p",{key:1,style:ct([{position:"absolute"},{left:X(f)-11+"px",top:X(p)+"px"}]),class:"sqrtsymbol"},"  ",4)):Ke("",!0)],512)),[[Ro,c.value]])}});const Fl=["id"],Xl=tt({__name:"MathBoard",props:{svgId:{type:String,default:""},loaded:{type:Boolean,default:!1}},setup(e){const t=e,n=he(),r=et(),i=rn(),s=kl(),o=Ol();Hn(()=>{o.registerSvgMouseDown(t.svgId),o.registerSvgMouseMove(t.svgId),o.registerSvgMouseUp(t.svgId),o.registerKeyUp(),o.registerPaste()}),Oo(()=>{o.unregisterSvgMouseDown(t.svgId),o.unregisterSvgMouseMove(t.svgId),o.unregisterSvgMouseUp(t.svgId),o.unregisterKeyUp(),o.unregisterPaste()}),Q(()=>n.getActiveCell().value,(a,c)=>{a&&s.activateCell(t.svgId,c,a)},{immediate:!0,deep:!0}),Q(()=>t.loaded,a=>{a&&u()},{immediate:!0}),Q(()=>n.getNotations(),()=>{i.refreshScreen(Array.from(n.getNotations().value).map(([a,c])=>c),t.svgId,document.getElementById(t.svgId))},{immediate:!0,deep:!0}),Q(()=>r.bus.value.get("svgmousedown"),a=>{s.activateClickedObject(a)});function u(){s.reset(),i.setMatrix(t.svgId)}return(a,c)=>(fe(),vt(pt,null,[_($e,null,{default:k(()=>[_(ze,{cols:"12",class:"d-flex justify-center"},{default:k(()=>[Mo(a.$slots,"title")]),_:3})]),_:3}),_($e,{class:"fill-height"},{default:k(()=>[_(ze,{colls:"1"},{default:k(()=>[_(Il)]),_:1}),_(ze,{cols:"11"},{default:k(()=>[_(Dl,{svgId:e.svgId},null,8,["svgId"]),_(Hl,{svgId:e.svgId},null,8,["svgId"]),(fe(),vt("svg",{id:e.svgId,x:"0",y:"0",width:"100%",height:"100%"},null,8,Fl))]),_:1})]),_:1})],64))}});const vn=he(),yn=Ur();function Yl(){async function e(n){let r=[];for(let i=0;i<mn.length;i++){const s=mn[i];(await t(n,s)).forEach(u=>{r.push({...u,notationType:s})})}vn.setNotations(r)}async function t(n,r){n||(n=vn.getParent().value.type);let i=vn.getParent().value.uuid;switch(r){case"SYMBOL":case"SIGN":case"POWER":return await yn.getNotations(r,n,i);case"FRACTION":case"SQRT":return await yn.getNotations(r,n,i);case"GEO":case"IMAGE":case"TEXT":return await yn.getNotations(r,n,i);default:return[]}}return{loadNotations:e}}export{Xl as _,rn as a,Yl as n,eo as u};
